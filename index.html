<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการสินค้าและการขาย | Inventory & Sales Management</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/dataTables.tailwindcss.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Animate.css for animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Chart.js for reports -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.tailwindcss.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* ปรับแต่ง Scrollbar ให้เข้ากับธีมมืด */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* เอฟเฟกต์สำหรับการ hover ในตาราง */
        .hover-effect:hover {
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
        
        /* เอฟเฟกต์ปุ่ม */
        .btn-glow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }
        .btn-glow:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.7);
        }
        
        /* Animation สำหรับการแสดงผล */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* Badge สำหรับแสดงสิทธิ์ */
        .role-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .role-admin {
            background-color: #7c3aed;
            color: white;
        }
        
        .role-user {
            background-color: #059669;
            color: white;
        }
        
        .role-manager {
            background-color: #d97706;
            color: white;
        }
        
        /* Floating animation */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Page transition */
        .page-transition {
            transition: opacity 0.3s ease;
        }
        
        /* Hidden class */
        .hidden {
            display: none !important;
        }
        
        /* Custom Alert Styles */
        .alert-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 9999;
            max-width: 400px;
            width: 100%;
        }
        
        .alert {
            display: flex;
            align-items: center;
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-left-width: 4px;
        }
        
        .alert.show {
            transform: translateX(0);
        }
        
        .alert-success {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
            border-left-color: #10b981;
            color: #d1fae5;
        }
        
        .alert-error {
            background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
            border-left-color: #ef4444;
            color: #fecaca;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
            border-left-color: #f59e0b;
            color: #fef3c7;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            border-left-color: #3b82f6;
            color: #dbeafe;
        }
        
        .alert-icon {
            font-size: 1.5rem;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        
        .alert-content {
            flex-grow: 1;
        }
        
        .alert-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }
        
        .alert-message {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .alert-close {
            background: transparent;
            border: none;
            color: inherit;
            font-size: 1.25rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
            margin-left: 0.5rem;
            flex-shrink: 0;
        }
        
        .alert-close:hover {
            opacity: 1;
        }
        
        /* Pulse animation for notification */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 9998;
            max-width: 350px;
            border-left: 4px solid #3b82f6;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* Confirmation Dialog Styles */
        .confirmation-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border-radius: 1rem;
            padding: 0;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.75);
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 450px;
            width: 90%;
            overflow: hidden;
        }
        
        .confirmation-dialog.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .confirmation-header {
            padding: 1.5rem;
            border-bottom: 1px solid #374151;
            text-align: center;
        }
        
        .confirmation-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .confirmation-body {
            padding: 1.5rem;
            text-align: center;
        }
        
        .confirmation-footer {
            padding: 1.5rem;
            border-top: 1px solid #374151;
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }
        
        /* Product Card Hover Effect */
        .product-card {
            transition: all 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        /* Shimmer Effect */
        .shimmer {
            background: linear-gradient(90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.1) 50%, 
                rgba(255,255,255,0) 100%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* Navigation Styles */
        .nav-link {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-link:hover {
            background-color: #374151;
        }
        
        .nav-link.active {
            background-color: #4f46e5;
            color: white;
        }
        
        /* Tab Styles */
        .tab {
            padding: 0.75rem 1.5rem;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background-color: #374151;
        }
        
        .tab.active {
            border-bottom-color: #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }
        
        /* Permission Badge */
        .permission-badge {
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 0.25rem;
            margin: 0.1rem;
            display: inline-block;
        }
        
        .permission-allowed {
            background-color: #10b981;
            color: white;
        }
        
        .permission-denied {
            background-color: #ef4444;
            color: white;
        }
        
        .permission-partial {
            background-color: #f59e0b;
            color: white;
        }
        
        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-section, .print-section * {
                visibility: visible;
            }
            
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
                color: black;
                padding: 20px;
            }
            
            .no-print {
                display: none !important;
            }
        }
        
        /* Sale Receipt Styles */
        .receipt {
            font-family: 'Courier New', monospace;
            background: white;
            color: black;
            padding: 20px;
            max-width: 300px;
            margin: 0 auto;
            border: 1px dashed #ccc;
        }
        
        .receipt-header {
            text-align: center;
            border-bottom: 1px dashed #000;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        
        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .receipt-total {
            border-top: 2px solid #000;
            margin-top: 10px;
            padding-top: 10px;
            font-weight: bold;
        }
        
        /* Sale Form Styles */
        .sale-item {
            background: #374151;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #4f46e5;
        }
        
        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <!-- Alert Container -->
    <div id="alertContainer" class="alert-container"></div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="text-center">
            <div class="inline-block p-6 bg-gray-800 rounded-2xl shadow-2xl animate__animated animate__pulse">
                <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p class="text-white text-lg font-medium" id="loadingMessage">กำลังโหลดข้อมูล...</p>
                <p class="text-gray-400 text-sm mt-2 animate-pulse">กรุณารอสักครู่</p>
            </div>
        </div>
    </div>

    <!-- Login Page (จะแสดงเป็นหน้าแรก) -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4 page-transition">
        <!-- Login Container -->
        <div class="bg-gray-800 rounded-2xl shadow-2xl overflow-hidden w-full max-w-md animate__animated animate__fadeIn">
            <!-- Header -->
            <div class="bg-gradient-to-r from-indigo-700 to-purple-700 p-8 text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-black opacity-10"></div>
                <div class="floating inline-block p-4 bg-white/10 rounded-full mb-4 relative z-10">
                    <i class="fas fa-cash-register text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-white relative z-10">ระบบจัดการขายสินค้า</h1>
                <p class="text-indigo-200 mt-2 relative z-10">Inventory & Sales Management System</p>
                
                <!-- Decorative elements -->
                <div class="absolute top-0 left-0 w-20 h-20 bg-white/5 rounded-full -translate-x-10 -translate-y-10"></div>
                <div class="absolute bottom-0 right-0 w-32 h-32 bg-white/5 rounded-full translate-x-16 translate-y-16"></div>
            </div>
            
            <!-- Login Form -->
            <div class="p-8">
                <h2 class="text-2xl font-bold text-white mb-2 animate__animated animate__fadeIn animate__delay-1s">เข้าสู่ระบบ</h2>
                <p class="text-gray-400 mb-6 animate__animated animate__fadeIn animate__delay-1s">กรุณากรอกข้อมูลเพื่อเข้าสู่ระบบ</p>
                
                <form id="loginForm" class="animate__animated animate__fadeIn animate__delay-1s">
                    <div class="space-y-5">
                        <div class="animate__animated animate__fadeInUp animate__delay-2s">
                            <label for="username" class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-user mr-2"></i>ชื่อผู้ใช้
                            </label>
                            <input 
                                type="text" 
                                id="username" 
                                required 
                                placeholder="กรอกชื่อผู้ใช้"
                                class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 transition-all duration-300"
                            >
                        </div>
                        
                        <div class="animate__animated animate__fadeInUp animate__delay-3s">
                            <label for="password" class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-lock mr-2"></i>รหัสผ่าน
                            </label>
                            <input 
                                type="password" 
                                id="password" 
                                required 
                                placeholder="กรอกรหัสผ่าน"
                                class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 transition-all duration-300"
                            >
                        </div>
                        
                        <div class="pt-4 animate__animated animate__fadeInUp animate__delay-4s">
                            <button 
                                type="submit" 
                                id="loginBtn"
                                class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center space-x-2 btn-glow transition-all duration-300 pulse"
                            >
                                <i class="fas fa-sign-in-alt"></i>
                                <span>เข้าสู่ระบบ</span>
                            </button>
                        </div>
                    </div>
                </form>
                
                <!-- Demo Accounts -->
                <div class="mt-8 pt-6 border-t border-gray-700 animate__animated animate__fadeIn animate__delay-5s">
                    <h3 class="text-sm font-medium text-gray-300 mb-3 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-yellow-400"></i> บัญชีสำหรับทดสอบระบบ:
                    </h3>
                    <div class="space-y-2 text-sm">
                        <div class="bg-gray-900/50 p-3 rounded-lg product-card">
                            <p class="text-gray-400"><span class="font-medium text-gray-300">ผู้ใช้ทั่วไป:</span> user / user123</p>
                            <p class="text-gray-400 text-xs mt-1">สามารถดูข้อมูลและเพิ่มสินค้าได้ แต่ไม่สามารถลบได้</p>
                        </div>
                        <div class="bg-gray-900/50 p-3 rounded-lg product-card">
                            <p class="text-gray-400"><span class="font-medium text-gray-300">ผู้จัดการ:</span> manager / manager123</p>
                            <p class="text-gray-400 text-xs mt-1">สามารถดูข้อมูลและเพิ่มสินค้าได้ แต่ไม่สามารถลบได้</p>
                        </div>
                        <div class="bg-gray-900/50 p-3 rounded-lg product-card">
                            <p class="text-gray-400"><span class="font-medium text-gray-300">ผู้ดูแลระบบ:</span> admin / admin123</p>
                            <p class="text-gray-400 text-xs mt-1">สามารถใช้งานได้ทุกฟังก์ชัน รวมถึงการลบข้อมูลและจัดการผู้ใช้</p>
                        </div>
                    </div>
                </div>
                
                <!-- System Status -->
                <div class="mt-6 p-3 bg-gray-900/30 rounded-lg animate__animated animate__fadeIn animate__delay-6s">
                    <div class="flex items-center">
                        <div id="firebaseStatus" class="w-3 h-3 rounded-full bg-green-500 mr-3 animate-pulse"></div>
                        <p id="firebaseStatusText" class="text-gray-300 text-sm">ระบบพร้อมใช้งาน</p>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="bg-gray-900 p-4 text-center animate__animated animate__fadeIn animate__delay-6s">
                <p class="text-gray-500 text-sm">
                    <i class="fas fa-cube mr-1"></i> ระบบจัดการสินค้าและการขายด้วย Firebase
                </p>
            </div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="appContainer" class="hidden">
        <!-- Header -->
        <header class="bg-gray-800 shadow-lg sticky top-0 z-50 animate__animated animate__fadeInDown">
            <div class="container mx-auto px-4 py-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center space-x-3 mb-4 md:mb-0">
                        <a href="#" id="homeBtn" class="flex items-center space-x-3">
                            <div class="bg-indigo-600 p-3 rounded-lg hover-effect">
                                <i class="fas fa-cash-register text-white text-2xl"></i>
                            </div>
                            <div>
                                <h1 class="text-2xl md:text-3xl font-bold">ระบบจัดการขายสินค้า</h1>
                                <p class="text-gray-400 text-sm">ระบบจัดการสินค้า การขาย และรายงานแบบครบวงจร</p>
                            </div>
                        </a>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- User Info -->
                        <div class="hidden md:flex items-center space-x-3 bg-gray-700 px-4 py-2 rounded-lg product-card cursor-pointer" id="userInfoBtn">
                            <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center hover-effect">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            <div>
                                <p class="font-medium" id="currentUsername">กำลังโหลด...</p>
                                <div class="flex items-center space-x-2">
                                    <span id="userRoleBadge" class="role-badge role-user">ผู้ใช้ทั่วไป</span>
                                    <span class="text-gray-400 text-xs" id="userRoleText"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notification Bell -->
                        <div class="relative">
                            <button id="notificationBtn" class="p-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors relative">
                                <i class="fas fa-bell text-gray-300"></i>
                                <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                            </button>
                        </div>
                        
                        <!-- Logout Button -->
                        <button id="logoutBtn" class="bg-gradient-to-r from-gray-700 to-gray-600 hover:from-gray-600 hover:to-gray-500 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>ออกจากระบบ</span>
                        </button>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="mt-4 flex flex-wrap gap-2 border-t border-gray-700 pt-4">
                    <button id="navDashboard" class="nav-link active">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>แดชบอร์ด</span>
                    </button>
                    <button id="navProducts" class="nav-link">
                        <i class="fas fa-box"></i>
                        <span>จัดการสินค้า</span>
                    </button>
                    <button id="navSales" class="nav-link">
                        <i class="fas fa-shopping-cart"></i>
                        <span>จัดการการขาย</span>
                    </button>
                    <button id="navSalesReport" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>รายงานการขาย</span>
                    </button>
                    <button id="navUsers" class="nav-link">
                        <i class="fas fa-users"></i>
                        <span>จัดการผู้ใช้</span>
                    </button>
                    <button id="navReports" class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>รายงาน</span>
                    </button>
                    <button id="navSettings" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span>ตั้งค่าระบบ</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page-content">
                <!-- Welcome Message -->
                <div class="bg-gradient-to-r from-gray-800 to-gray-700 rounded-xl p-6 shadow-lg mb-8 animate__animated animate__fadeIn">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                        <div>
                            <h2 class="text-2xl font-bold mb-2 animate__animated animate__fadeInLeft">ยินดีต้อนรับ, <span id="welcomeUsername" class="text-indigo-300">ผู้ใช้</span>!</h2>
                            <p class="text-gray-300 animate__animated animate__fadeInLeft animate__delay-1s" id="welcomeMessage">คุณกำลังใช้ระบบจัดการสินค้าและการขาย</p>
                        </div>
                        <div class="mt-4 md:mt-0 animate__animated animate__fadeInRight">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></div>
                                <p class="text-green-300 text-sm" id="connectionStatus">เชื่อมต่อฐานข้อมูลสำเร็จ</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 rounded-xl p-6 shadow-lg hover-effect product-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-400 text-sm">จำนวนสินค้าทั้งหมด</p>
                                <h3 id="totalProducts" class="text-3xl font-bold mt-2 shimmer">0</h3>
                            </div>
                            <div class="bg-indigo-900 p-4 rounded-lg hover-effect">
                                <i class="fas fa-box text-indigo-300 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl p-6 shadow-lg hover-effect product-card animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-400 text-sm">มูลค่าสินค้าทั้งหมด</p>
                                <h3 id="totalValue" class="text-3xl font-bold mt-2 shimmer">฿0</h3>
                            </div>
                            <div class="bg-green-900 p-4 rounded-lg hover-effect">
                                <i class="fas fa-coins text-green-300 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl p-6 shadow-lg hover-effect product-card animate__animated animate__fadeInUp" style="animation-delay: 0.3s">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-400 text-sm">สินค้าหมดสต๊อก</p>
                                <h3 id="outOfStock" class="text-3xl font-bold mt-2 shimmer">0</h3>
                            </div>
                            <div class="bg-red-900 p-4 rounded-lg hover-effect">
                                <i class="fas fa-exclamation-triangle text-red-300 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl p-6 shadow-lg hover-effect product-card animate__animated animate__fadeInUp" style="animation-delay: 0.4s">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-400 text-sm">ยอดขายวันนี้</p>
                                <h3 id="todaySales" class="text-3xl font-bold mt-2 shimmer">฿0</h3>
                            </div>
                            <div class="bg-purple-900 p-4 rounded-lg hover-effect">
                                <i class="fas fa-shopping-cart text-purple-300 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <button id="quickAddProductBtn" class="bg-gradient-to-r from-green-700 to-emerald-700 hover:from-green-800 hover:to-emerald-800 text-white font-bold py-3 px-4 rounded-lg flex flex-col items-center justify-center space-y-2 btn-glow transition-all duration-300 hover-effect animate__animated animate__fadeInUp" style="animation-delay: 0.5s">
                        <i class="fas fa-plus-circle text-2xl"></i>
                        <span class="text-sm">เพิ่มสินค้า</span>
                    </button>
                    
                    <button id="quickAddSaleBtn" class="bg-gradient-to-r from-blue-700 to-cyan-700 hover:from-blue-800 hover:to-cyan-800 text-white font-bold py-3 px-4 rounded-lg flex flex-col items-center justify-center space-y-2 btn-glow transition-all duration-300 hover-effect animate__animated animate__fadeInUp" style="animation-delay: 0.6s">
                        <i class="fas fa-cash-register text-2xl"></i>
                        <span class="text-sm">ขายสินค้า</span>
                    </button>
                    
                    <button id="quickReportBtn" class="bg-gradient-to-r from-purple-700 to-pink-700 hover:from-purple-800 hover:to-pink-800 text-white font-bold py-3 px-4 rounded-lg flex flex-col items-center justify-center space-y-2 btn-glow transition-all duration-300 hover-effect animate__animated animate__fadeInUp" style="animation-delay: 0.7s">
                        <i class="fas fa-chart-bar text-2xl"></i>
                        <span class="text-sm">รายงาน</span>
                    </button>
                    
                    <button id="quickHelpBtn" class="bg-gradient-to-r from-yellow-700 to-orange-700 hover:from-yellow-800 hover:to-orange-800 text-white font-bold py-3 px-4 rounded-lg flex flex-col items-center justify-center space-y-2 btn-glow transition-all duration-300 hover-effect animate__animated animate__fadeInUp" style="animation-delay: 0.8s">
                        <i class="fas fa-question-circle text-2xl"></i>
                        <span class="text-sm">ช่วยเหลือ</span>
                    </button>
                </div>
                
                <!-- Recent Activities -->
                <div class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8 animate__animated animate__fadeInUp" style="animation-delay: 0.9s">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-history mr-2 text-indigo-400"></i> กิจกรรมล่าสุด
                    </h2>
                    <div id="recentActivities" class="space-y-3">
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-clock text-2xl mb-2"></i>
                            <p>ยังไม่มีกิจกรรมล่าสุด</p>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Sales -->
                <div class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8 animate__animated animate__fadeInUp" style="animation-delay: 1s">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-shopping-cart mr-2 text-green-400"></i> การขายล่าสุด
                    </h2>
                    <div id="recentSales" class="space-y-3">
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-receipt text-2xl mb-2"></i>
                            <p>ยังไม่มีรายการขาย</p>
                        </div>
                    </div>
                </div>
                
                <!-- System Info -->
                <div class="bg-gray-800 rounded-xl shadow-lg p-6 animate__animated animate__fadeInUp" style="animation-delay: 1.1s">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-green-400"></i> ข้อมูลระบบ
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-gray-900/50 p-4 rounded-lg product-card hover-effect">
                            <p class="text-gray-400 text-sm">เวอร์ชันระบบ</p>
                            <p class="font-medium">4.0.0</p>
                        </div>
                        <div class="bg-gray-900/50 p-4 rounded-lg product-card hover-effect">
                            <p class="text-gray-400 text-sm">ฐานข้อมูล</p>
                            <p class="font-medium">Firebase Realtime Database</p>
                        </div>
                        <div class="bg-gray-900/50 p-4 rounded-lg product-card hover-effect">
                            <p class="text-gray-400 text-sm">ผู้พัฒนา</p>
                            <p class="font-medium">ระบบจัดการสินค้าและการขาย</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Management Page -->
            <div id="productsPage" class="page-content hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                    <div>
                        <h2 class="text-2xl font-bold flex items-center">
                            <i class="fas fa-box mr-2 text-indigo-400"></i> จัดการข้อมูลสินค้า
                        </h2>
                        <p class="text-gray-400 text-sm mt-1">เพิ่ม แก้ไข ลบ และจัดการข้อมูลสินค้าทั้งหมด</p>
                    </div>
                    <div class="mt-4 md:mt-0 flex space-x-2">
                        <button id="addProductMainBtn" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-plus"></i>
                            <span>เพิ่มสินค้าใหม่</span>
                        </button>
                        <button id="exportProductsBtn" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-download"></i>
                            <span>ส่งออกข้อมูล</span>
                        </button>
                        <button id="refreshProductsBtn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-sync-alt"></i>
                            <span>รีเฟรช</span>
                        </button>
                    </div>
                </div>
                
                <!-- Product Table -->
                <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-8">
                    <div class="p-6 border-b border-gray-700">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div>
                                <h3 class="text-lg font-bold">รายการสินค้าทั้งหมด</h3>
                                <p class="text-gray-400 text-sm mt-1" id="productsTableInfo">แสดงข้อมูลสินค้าทั้งหมดในระบบ</p>
                            </div>
                            <div class="mt-3 md:mt-0">
                                <div class="flex items-center space-x-2">
                                    <div class="relative">
                                        <input type="text" id="productSearch" placeholder="ค้นหาสินค้า..." class="bg-gray-700 border border-gray-600 rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent w-64">
                                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <table id="productsTable" class="min-w-full divide-y divide-gray-700">
                            <thead>
                                <tr class="bg-gray-900">
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">รหัสสินค้า</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ชื่อสินค้า</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ประเภท</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">จำนวน</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ราคา/หน่วย</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">มูลค่ารวม</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody" class="divide-y divide-gray-700">
                                <!-- ข้อมูลจะถูกเพิ่มโดย JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Product Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-indigo-800 to-purple-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-box-open text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">สินค้าทั้งหมด</p>
                                <p id="totalProductsCount" class="text-2xl font-bold">0 รายการ</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-800 to-emerald-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-coins text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">มูลค่ารวม</p>
                                <p id="totalProductsValue" class="text-2xl font-bold">฿0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-red-800 to-pink-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-exclamation-triangle text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">สินค้าหมดสต๊อก</p>
                                <p id="outOfStockCount" class="text-2xl font-bold">0 รายการ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Management Page -->
            <div id="salesPage" class="page-content hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                    <div>
                        <h2 class="text-2xl font-bold flex items-center">
                            <i class="fas fa-shopping-cart mr-2 text-green-400"></i> จัดการการขายสินค้า
                        </h2>
                        <p class="text-gray-400 text-sm mt-1">สร้างรายการขายใหม่ ตัดสต๊อกสินค้า และจัดการประวัติการขาย</p>
                    </div>
                    <div class="mt-4 md:mt-0 flex space-x-2">
                        <button id="newSaleBtn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-plus-circle"></i>
                            <span>สร้างการขายใหม่</span>
                        </button>
                        <button id="refreshSalesBtn" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-sync-alt"></i>
                            <span>รีเฟรช</span>
                        </button>
                    </div>
                </div>
                
                <!-- New Sale Form -->
                <div id="newSaleForm" class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-receipt mr-2 text-yellow-400"></i> รายการขายใหม่
                    </h3>
                    
                    <form id="saleForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="saleCode" class="block text-sm font-medium text-gray-300 mb-2">รหัสการขาย *</label>
                                <input type="text" id="saleCode" value="SALE-001" readonly class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                            </div>
                            <div>
                                <label for="customerName" class="block text-sm font-medium text-gray-300 mb-2">ชื่อลูกค้า</label>
                                <input type="text" id="customerName" placeholder="กรอกชื่อลูกค้า (ถ้ามี)" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                            </div>
                        </div>
                        
                        <!-- Product Selection -->
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-medium">เลือกรายการสินค้า</h4>
                                <button type="button" id="addSaleItemBtn" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 rounded-lg transition-colors hover-effect flex items-center space-x-2">
                                    <i class="fas fa-plus"></i>
                                    <span>เพิ่มสินค้า</span>
                                </button>
                            </div>
                            
                            <div id="saleItemsContainer" class="space-y-4">
                                <!-- Sale items will be added here -->
                            </div>
                        </div>
                        
                        <!-- Sale Summary -->
                        <div class="bg-gray-900/50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-medium mb-4">สรุปรายการขาย</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <p class="text-gray-400 text-sm">จำนวนรายการ</p>
                                    <p id="totalItemsCount" class="text-2xl font-bold">0</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 text-sm">รวมจำนวนสินค้า</p>
                                    <p id="totalQuantityCount" class="text-2xl font-bold">0 ชิ้น</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 text-sm">ยอดรวมทั้งหมด</p>
                                    <p id="totalSaleAmount" class="text-2xl font-bold text-green-400">฿0.00</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex justify-end space-x-3">
                            <button type="button" id="clearSaleBtn" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors hover-effect">
                                ล้างรายการ
                            </button>
                            <button type="submit" id="saveSaleBtn" class="px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-lg transition-colors hover-effect flex items-center space-x-2">
                                <i class="fas fa-check-circle"></i>
                                <span>บันทึกการขาย</span>
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Sales History -->
                <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                    <div class="p-6 border-b border-gray-700">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div>
                                <h3 class="text-lg font-bold">ประวัติการขาย</h3>
                                <p class="text-gray-400 text-sm mt-1">แสดงประวัติการขายทั้งหมดในระบบ</p>
                            </div>
                            <div class="mt-3 md:mt-0">
                                <div class="flex items-center space-x-2">
                                    <div class="relative">
                                        <input type="text" id="saleSearch" placeholder="ค้นหารายการขาย..." class="bg-gray-700 border border-gray-600 rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent w-64">
                                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <table id="salesTable" class="min-w-full divide-y divide-gray-700">
                            <thead>
                                <tr class="bg-gray-900">
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">รหัสการขาย</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ลูกค้า</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">จำนวนรายการ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ยอดรวม</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">วันที่ขาย</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">พนักงานขาย</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="salesTableBody" class="divide-y divide-gray-700">
                                <!-- ข้อมูลจะถูกเพิ่มโดย JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sales Report Page -->
            <div id="salesReportPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-chart-line mr-2 text-green-400"></i> รายงานการขาย
                    </h2>
                    <p class="text-gray-400 text-sm mt-1">วิเคราะห์ข้อมูลการขายและสรุปรายงาน</p>
                </div>
                
                <!-- Report Filters -->
                <div class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-lg font-bold mb-4">ตัวกรองรายงาน</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label for="reportPeriod" class="block text-sm font-medium text-gray-300 mb-2">ช่วงเวลา</label>
                            <select id="reportPeriod" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                                <option value="today">วันนี้</option>
                                <option value="yesterday">เมื่อวาน</option>
                                <option value="week">สัปดาห์นี้</option>
                                <option value="month">เดือนนี้</option>
                                <option value="year">ปีนี้</option>
                                <option value="custom">กำหนดเอง</option>
                            </select>
                        </div>
                        <div id="customDateRange" class="hidden md:col-span-2">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="startDate" class="block text-sm font-medium text-gray-300 mb-2">ตั้งแต่</label>
                                    <input type="date" id="startDate" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                                </div>
                                <div>
                                    <label for="endDate" class="block text-sm font-medium text-gray-300 mb-2">ถึง</label>
                                    <input type="date" id="endDate" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                                </div>
                            </div>
                        </div>
                        <div class="flex items-end">
                            <button id="generateReportBtn" class="w-full px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-lg transition-colors hover-effect">
                                สร้างรายงาน
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Sales Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-green-800 to-emerald-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-shopping-cart text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">จำนวนรายการขาย</p>
                                <p id="totalSalesCount" class="text-2xl font-bold">0 รายการ</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-800 to-cyan-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-coins text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">ยอดขายรวม</p>
                                <p id="totalSalesAmount" class="text-2xl font-bold">฿0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-800 to-pink-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-boxes text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">จำนวนสินค้าที่ขาย</p>
                                <p id="totalSoldItems" class="text-2xl font-bold">0 ชิ้น</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-800 to-orange-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-chart-line text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">ยอดขายเฉลี่ย/รายการ</p>
                                <p id="averageSaleAmount" class="text-2xl font-bold">฿0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold mb-4">ยอดขายรายวัน</h3>
                        <div class="chart-container">
                            <canvas id="dailySalesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold mb-4">ประเภทสินค้าขายดี</h3>
                        <div class="chart-container">
                            <canvas id="productCategoryChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Top Products -->
                <div class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-lg font-bold mb-4">สินค้าขายดีอันดับต้นๆ</h3>
                    <div id="topProductsList" class="space-y-3">
                        <!-- Top products will be loaded here -->
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-chart-bar text-2xl mb-2"></i>
                            <p>ยังไม่มีข้อมูลสินค้าขายดี</p>
                        </div>
                    </div>
                </div>
                
                <!-- Export Options -->
                <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4">ตัวเลือกการส่งออก</h3>
                    <div class="flex flex-wrap gap-4">
                        <button id="exportSalesReportBtn" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-file-export"></i>
                            <span>ส่งออกรายงานการขาย</span>
                        </button>
                        <button id="printSalesReportBtn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-print"></i>
                            <span>พิมพ์รายงาน</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Users Management Page -->
            <div id="usersPage" class="page-content hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                    <div>
                        <h2 class="text-2xl font-bold flex items-center">
                            <i class="fas fa-users mr-2 text-indigo-400"></i> จัดการข้อมูลผู้ใช้
                        </h2>
                        <p class="text-gray-400 text-sm mt-1">เพิ่ม แก้ไข ลบ และจัดการสิทธิ์ผู้ใช้ทั้งหมดในระบบ</p>
                    </div>
                    <div class="mt-4 md:mt-0 flex space-x-2">
                        <button id="addUserBtn" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-user-plus"></i>
                            <span>เพิ่มผู้ใช้ใหม่</span>
                        </button>
                        <button id="refreshUsersBtn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-sync-alt"></i>
                            <span>รีเฟรช</span>
                        </button>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-8">
                    <div class="p-6 border-b border-gray-700">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div>
                                <h3 class="text-lg font-bold">รายการผู้ใช้ทั้งหมด</h3>
                                <p class="text-gray-400 text-sm mt-1">แสดงข้อมูลผู้ใช้ทั้งหมดในระบบ</p>
                            </div>
                            <div class="mt-3 md:mt-0">
                                <div class="flex items-center space-x-2">
                                    <div class="relative">
                                        <input type="text" id="userSearch" placeholder="ค้นหาผู้ใช้..." class="bg-gray-700 border border-gray-600 rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent w-64">
                                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <table id="usersTable" class="min-w-full divide-y divide-gray-700">
                            <thead>
                                <tr class="bg-gray-900">
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ชื่อผู้ใช้</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">บทบาท</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">สิทธิ์การใช้งาน</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ล็อกอินล่าสุด</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody" class="divide-y divide-gray-700">
                                <!-- ข้อมูลจะถูกเพิ่มโดย JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- User Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-indigo-800 to-purple-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-users text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">ผู้ใช้ทั้งหมด</p>
                                <p id="totalUsersCount" class="text-2xl font-bold">0 คน</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-800 to-cyan-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-user-shield text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">ผู้ดูแลระบบ</p>
                                <p id="adminUsersCount" class="text-2xl font-bold">0 คน</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-800 to-emerald-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-user text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">ผู้ใช้ทั่วไป</p>
                                <p id="normalUsersCount" class="text-2xl font-bold">0 คน</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-800 to-orange-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center">
                            <div class="mr-4">
                                <i class="fas fa-user-tie text-3xl text-white"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-sm">ผู้จัดการ</p>
                                <p id="managerUsersCount" class="text-2xl font-bold">0 คน</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Permissions Guide -->
                <div class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-key mr-2 text-yellow-400"></i> คู่มือสิทธิ์การใช้งาน
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead>
                                <tr class="bg-gray-900">
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ฟังก์ชัน</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ผู้ดูแลระบบ</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ผู้จัดการ</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ผู้ใช้ทั่วไป</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                <tr>
                                    <td class="px-4 py-3">ดูข้อมูลสินค้า</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">เพิ่มสินค้าใหม่</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">ขายสินค้า</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">แก้ไขข้อมูลสินค้า</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">ลบข้อมูลสินค้า</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">จัดการผู้ใช้</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">กำหนดสิทธิ์</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">ดูรายงาน</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">ตั้งค่าระบบ</td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-allowed">อนุญาต</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                    <td class="px-4 py-3"><span class="permission-badge permission-denied">ห้ามใช้</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reportsPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-chart-bar mr-2 text-indigo-400"></i> รายงานและสถิติ
                    </h2>
                    <p class="text-gray-400 text-sm mt-1">วิเคราะห์ข้อมูลและสร้างรายงานจากข้อมูลในระบบ</p>
                </div>
                
                <!-- Report Tabs -->
                <div class="flex border-b border-gray-700 mb-6">
                    <div class="tab active" data-tab="productReport">รายงานสินค้า</div>
                    <div class="tab" data-tab="userReport">รายงานผู้ใช้</div>
                    <div class="tab" data-tab="salesReport">รายงานการขาย</div>
                </div>
                
                <!-- Product Report -->
                <div id="productReport" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-bold mb-4">สรุปข้อมูลสินค้า</h3>
                            <div id="productSummary" class="space-y-3">
                                <!-- Product summary will be loaded here -->
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-bold mb-4">สินค้าขายดี</h3>
                            <div id="topProducts" class="space-y-3">
                                <!-- Top products will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl p-6 shadow-lg mb-8">
                        <h3 class="text-lg font-bold mb-4">สถานะสินค้า</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="text-center p-4 bg-green-900/30 rounded-lg">
                                <div class="text-3xl font-bold text-green-400" id="inStockCount">0</div>
                                <div class="text-sm text-gray-300">พร้อมจำหน่าย</div>
                            </div>
                            <div class="text-center p-4 bg-yellow-900/30 rounded-lg">
                                <div class="text-3xl font-bold text-yellow-400" id="lowStockCount">0</div>
                                <div class="text-sm text-gray-300">เหลือน้อย</div>
                            </div>
                            <div class="text-center p-4 bg-red-900/30 rounded-lg">
                                <div class="text-3xl font-bold text-red-400" id="outStockCount">0</div>
                                <div class="text-sm text-gray-300">หมดสต๊อก</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Report -->
                <div id="userReport" class="tab-content hidden">
                    <div class="bg-gray-800 rounded-xl p-6 shadow-lg mb-8">
                        <h3 class="text-lg font-bold mb-4">สรุปข้อมูลผู้ใช้</h3>
                        <div id="userSummary" class="space-y-4">
                            <!-- User summary will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Sales Report -->
                <div id="salesReport" class="tab-content hidden">
                    <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-lg font-bold mb-4">รายงานการขาย</h3>
                        <div class="text-center py-12 text-gray-500">
                            <i class="fas fa-chart-line text-4xl mb-4"></i>
                            <p>รายงานการขายได้ย้ายไปยังเมนู "รายงานการขาย" แล้ว</p>
                            <p class="text-sm mt-2">กรุณาไปที่เมนูรายงานการขายเพื่อดูรายละเอียด</p>
                        </div>
                    </div>
                </div>
                
                <!-- Export Options -->
                <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4">ตัวเลือกการส่งออก</h3>
                    <div class="flex flex-wrap gap-4">
                        <button id="exportProductReportBtn" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-file-export"></i>
                            <span>ส่งออกรายงานสินค้า</span>
                        </button>
                        <button id="exportUserReportBtn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-file-export"></i>
                            <span>ส่งออกรายงานผู้ใช้</span>
                        </button>
                        <button id="printReportBtn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-print"></i>
                            <span>พิมพ์รายงาน</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settingsPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-cog mr-2 text-indigo-400"></i> ตั้งค่าระบบ
                    </h2>
                    <p class="text-gray-400 text-sm mt-1">จัดการการตั้งค่าระบบและปรับแต่งการทำงาน</p>
                </div>
                
                <!-- System Settings -->
                <div class="bg-gray-800 rounded-xl p-6 shadow-lg mb-8">
                    <h3 class="text-lg font-bold mb-4">การตั้งค่าระบบ</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-gray-900/50 rounded-lg">
                            <div>
                                <p class="font-medium">แสดงการแจ้งเตือน</p>
                                <p class="text-gray-400 text-sm">แสดงการแจ้งเตือนเมื่อมีกิจกรรมใหม่</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notificationToggle" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-gray-900/50 rounded-lg">
                            <div>
                                <p class="font-medium">โหมดมืด</p>
                                <p class="text-gray-400 text-sm">ใช้ธีมสีมืดสำหรับการแสดงผล</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="darkModeToggle" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-gray-900/50 rounded-lg">
                            <div>
                                <p class="font-medium">รีเฟรชอัตโนมัติ</p>
                                <p class="text-gray-400 text-sm">รีเฟรชข้อมูลอัตโนมัติทุก 30 วินาที</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoRefreshToggle" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Database Management -->
                <div class="bg-gray-800 rounded-xl p-6 shadow-lg mb-8">
                    <h3 class="text-lg font-bold mb-4">จัดการฐานข้อมูล</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="backupDataBtn" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-database"></i>
                            <span>สำรองข้อมูล</span>
                        </button>
                        <button id="resetDemoDataBtn" class="bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-700 hover:to-orange-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center space-x-2 btn-glow transition-all duration-300 hover-effect">
                            <i class="fas fa-redo"></i>
                            <span>รีเซ็ตข้อมูลตัวอย่าง</span>
                        </button>
                    </div>
                </div>
                
                <!-- System Information -->
                <div class="bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4">ข้อมูลระบบ</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gray-900/30 rounded-lg">
                            <span class="text-gray-400">เวอร์ชันระบบ</span>
                            <span class="font-medium">4.0.0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-900/30 rounded-lg">
                            <span class="text-gray-400">ฐานข้อมูล</span>
                            <span class="font-medium">Firebase Realtime Database</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-900/30 rounded-lg">
                            <span class="text-gray-400">ผู้พัฒนาระบบ</span>
                            <span class="font-medium">ระบบจัดการสินค้าและการขาย</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-900/30 rounded-lg">
                            <span class="text-gray-400">การเชื่อมต่อ</span>
                            <span id="systemConnectionStatus" class="font-medium text-green-400">ออนไลน์</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-900/30 rounded-lg">
                            <span class="text-gray-400">เวลาปัจจุบัน</span>
                            <span id="systemTime" class="font-medium">กำลังโหลด...</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 border-t border-gray-700 py-6 mt-8">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <p class="text-gray-400">
                            <i class="fas fa-cube mr-1"></i> ระบบจัดการสินค้าและการขายด้วย Firebase
                        </p>
                        <p class="text-gray-500 text-sm mt-1">ครบเครื่องเรื่องไอที</p>
                    </div>
                    <div class="flex space-x-4">
                        <a href="https://firebase.google.com/" target="_blank" class="text-gray-400 hover:text-indigo-400 transition-colors hover-effect">
                            <i class="fab fa-google"></i> Firebase
                        </a>
                        <a href="https://tailwindcss.com/" target="_blank" class="text-gray-400 hover:text-blue-400 transition-colors hover-effect">
                            <i class="fab fa-css3-alt"></i> Tailwind CSS
                        </a>
                        <a href="https://datatables.net/" target="_blank" class="text-gray-400 hover:text-orange-400 transition-colors hover-effect">
                            <i class="fas fa-table"></i> DataTables
                        </a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal สำหรับเพิ่ม/แก้ไขสินค้า -->
    <div id="productModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-md mx-4 animate__animated animate__zoomIn">
            <div class="p-6 border-b border-gray-700">
                <h3 id="modalProductTitle" class="text-xl font-bold">เพิ่มสินค้าใหม่</h3>
            </div>
            
            <form id="productForm" class="p-6">
                <input type="hidden" id="productId">
                
                <div class="space-y-4">
                    <div>
                        <label for="productCode" class="block text-sm font-medium text-gray-300 mb-1">รหัสสินค้า *</label>
                        <input type="text" id="productCode" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                    </div>
                    
                    <div>
                        <label for="productName" class="block text-sm font-medium text-gray-300 mb-1">ชื่อสินค้า *</label>
                        <input type="text" id="productName" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                    </div>
                    
                    <div>
                        <label for="productCategory" class="block text-sm font-medium text-gray-300 mb-1">ประเภท *</label>
                        <select id="productCategory" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                            <option value="">เลือกประเภทสินค้า</option>
                            <option value="อิเล็กทรอนิกส์">อิเล็กทรอนิกส์</option>
                            <option value="เครื่องเขียน">เครื่องเขียน</option>
                            <option value="เฟอร์นิเจอร์">เฟอร์นิเจอร์</option>
                            <option value="เครื่องดื่ม">เครื่องดื่ม</option>
                            <option value="อาหาร">อาหาร</option>
                            <option value="อื่นๆ">อื่นๆ</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="productQuantity" class="block text-sm font-medium text-gray-300 mb-1">จำนวน *</label>
                            <input type="number" id="productQuantity" required min="0" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                        </div>
                        
                        <div>
                            <label for="productPrice" class="block text-sm font-medium text-gray-300 mb-1">ราคาต่อหน่วย *</label>
                            <input type="number" id="productPrice" required min="0" step="0.01" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-8">
                    <button type="button" id="cancelProductModalBtn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors hover-effect">ยกเลิก</button>
                    <button type="submit" id="saveProductBtn" class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-lg transition-colors hover-effect">บันทึกข้อมูล</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal สำหรับเพิ่ม/แก้ไขผู้ใช้ -->
    <div id="userModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-md mx-4 animate__animated animate__zoomIn">
            <div class="p-6 border-b border-gray-700">
                <h3 id="modalUserTitle" class="text-xl font-bold">เพิ่มผู้ใช้ใหม่</h3>
            </div>
            
            <form id="userForm" class="p-6">
                <input type="hidden" id="userId">
                
                <div class="space-y-4">
                    <div>
                        <label for="newUsername" class="block text-sm font-medium text-gray-300 mb-1">ชื่อผู้ใช้ *</label>
                        <input type="text" id="newUsername" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                    </div>
                    
                    <div>
                        <label for="newPassword" class="block text-sm font-medium text-gray-300 mb-1">รหัสผ่าน *</label>
                        <input type="password" id="newPassword" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                    </div>
                    
                    <div>
                        <label for="fullName" class="block text-sm font-medium text-gray-300 mb-1">ชื่อ-นามสกุล *</label>
                        <input type="text" id="fullName" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                    </div>
                    
                    <div>
                        <label for="userRole" class="block text-sm font-medium text-gray-300 mb-1">บทบาท *</label>
                        <select id="userRole" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                            <option value="">เลือกบทบาทผู้ใช้</option>
                            <option value="user">ผู้ใช้ทั่วไป</option>
                            <option value="manager">ผู้จัดการ</option>
                            <option value="admin">ผู้ดูแลระบบ</option>
                        </select>
                    </div>
                    
                    <!-- Permissions Section -->
                    <div class="pt-4 border-t border-gray-700">
                        <h4 class="font-medium text-gray-300 mb-3">สิทธิ์การใช้งาน</h4>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <span class="text-sm">ดูข้อมูลสินค้า</span>
                                <input type="checkbox" id="permView" class="h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500" checked disabled>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">เพิ่มสินค้าใหม่</span>
                                <input type="checkbox" id="permAdd" class="h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500" checked>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">ขายสินค้า</span>
                                <input type="checkbox" id="permSale" class="h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500" checked>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">แก้ไขข้อมูลสินค้า</span>
                                <input type="checkbox" id="permEdit" class="h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500" checked>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">ลบข้อมูลสินค้า</span>
                                <input type="checkbox" id="permDelete" class="h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500">
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">จัดการผู้ใช้</span>
                                <input type="checkbox" id="permManageUsers" class="h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500">
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">ดูรายงาน</span>
                                <input type="checkbox" id="permViewReports" class="h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-8">
                    <button type="button" id="cancelUserModalBtn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors hover-effect">ยกเลิก</button>
                    <button type="submit" id="saveUserBtn" class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-lg transition-colors hover-effect">บันทึกข้อมูล</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal สำหรับดูรายละเอียดการขาย -->
    <div id="saleDetailModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl mx-4 animate__animated animate__zoomIn">
            <div class="p-6 border-b border-gray-700">
                <h3 id="modalSaleTitle" class="text-xl font-bold">รายละเอียดการขาย</h3>
            </div>
            
            <div class="p-6">
                <div class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-gray-400 text-sm">รหัสการขาย</p>
                            <p id="saleDetailCode" class="font-medium text-lg"></p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm">ลูกค้า</p>
                            <p id="saleDetailCustomer" class="font-medium"></p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm">วันที่ขาย</p>
                            <p id="saleDetailDate" class="font-medium"></p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm">พนักงานขาย</p>
                            <p id="saleDetailStaff" class="font-medium"></p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="font-medium mb-3">รายการสินค้า</h4>
                    <div id="saleDetailItems" class="space-y-3">
                        <!-- Sale items will be loaded here -->
                    </div>
                </div>
                
                <div class="bg-gray-900/50 rounded-lg p-4">
                    <div class="flex justify-between items-center">
                        <p class="text-lg font-medium">ยอดรวมทั้งหมด</p>
                        <p id="saleDetailTotal" class="text-2xl font-bold text-green-400"></p>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-8">
                    <button type="button" id="printReceiptBtn" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 rounded-lg transition-colors hover-effect">
                        <i class="fas fa-print mr-2"></i> พิมพ์ใบเสร็จ
                    </button>
                    <button type="button" id="closeSaleDetailBtn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors hover-effect">ปิด</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div id="confirmationDialog" class="confirmation-dialog hidden">
        <div class="confirmation-header">
            <div id="confirmationIcon" class="confirmation-icon">
                <i class="fas fa-exclamation-triangle text-yellow-500"></i>
            </div>
            <h3 id="confirmationTitle" class="text-xl font-bold">ยืนยันการดำเนินการ</h3>
        </div>
        <div class="confirmation-body">
            <p id="confirmationMessage" class="text-gray-300">คุณแน่ใจหรือไม่ว่าต้องการดำเนินการนี้?</p>
        </div>
        <div class="confirmation-footer">
            <button id="cancelConfirmBtn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors hover-effect">ยกเลิก</button>
            <button id="confirmActionBtn" class="px-4 py-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 rounded-lg transition-colors hover-effect">ยืนยัน</button>
        </div>
    </div>

    <!-- Print Receipt Section -->
    <div id="printReceiptSection" class="print-section hidden">
        <div class="receipt" id="receiptContent">
            <!-- Receipt content will be generated here -->
        </div>
    </div>

    <!-- Firebase Configuration Script -->
    <script id="firebaseConfigScript">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAc9BtiDc0pOeX4uJpIOYLBTZ9DM6MkFCM",
            authDomain: "inventory-c74e1.firebaseapp.com",
            databaseURL: "https://inventory-c74e1-default-rtdb.firebaseio.com",
            projectId: "inventory-c74e1",
            storageBucket: "inventory-c74e1.firebasestorage.app",
            messagingSenderId: "95313330186",
            appId: "1:95313330186:web:b8b5b675a8e829e76bdff3",
            measurementId: "G-Y069B1FRNC"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        console.log("Firebase initialized successfully!");
    </script>

    <!-- Main Application Script -->
    <script>
        // ตัวแปรหลักของแอพพลิเคชัน
        let products = [];
        let users = [];
        let sales = [];
        let currentUser = null;
        let userToDelete = null;
        let productToDelete = null;
        let saleToDelete = null;
        let notifications = [];
        let recentActivities = [];
        let autoRefreshInterval = null;
        let saleItems = [];
        let saleCounter = 1;
        let dailySalesChart = null;
        let productCategoryChart = null;
        
        // สิทธิ์การใช้งานตามบทบาท
        const rolePermissions = {
            'admin': {
                canView: true,
                canAdd: true,
                canEdit: true,
                canDelete: true,
                canManageUsers: true,
                canViewReports: true,
                canManageSettings: true,
                canSale: true
            },
            'manager': {
                canView: true,
                canAdd: true,
                canEdit: true,
                canDelete: false,
                canManageUsers: false,
                canViewReports: true,
                canManageSettings: false,
                canSale: true
            },
            'user': {
                canView: true,
                canAdd: true,
                canEdit: true,
                canDelete: false,
                canManageUsers: false,
                canViewReports: false,
                canManageSettings: false,
                canSale: true
            }
        };
        
        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const appContainer = document.getElementById('appContainer');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const notificationPanel = document.getElementById('notificationPanel');
        
        // ==================== ALERT SYSTEM ====================
        
        // แสดง Alert แบบต่าง ๆ
        function showAlert(type, title, message, duration = 5000) {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert-' + Date.now();
            
            let icon = 'info-circle';
            let alertClass = 'alert-info';
            
            switch(type) {
                case 'success':
                    icon = 'check-circle';
                    alertClass = 'alert-success';
                    break;
                case 'error':
                    icon = 'exclamation-circle';
                    alertClass = 'alert-error';
                    break;
                case 'warning':
                    icon = 'exclamation-triangle';
                    alertClass = 'alert-warning';
                    break;
                case 'info':
                    icon = 'info-circle';
                    alertClass = 'alert-info';
                    break;
            }
            
            const alertElement = document.createElement('div');
            alertElement.id = alertId;
            alertElement.className = `alert ${alertClass}`;
            alertElement.innerHTML = `
                <div class="alert-icon">
                    <i class="fas fa-${icon}"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-title">${title}</div>
                    <div class="alert-message">${message}</div>
                </div>
                <button class="alert-close" onclick="closeAlert('${alertId}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            alertContainer.appendChild(alertElement);
            
            setTimeout(() => {
                alertElement.classList.add('show');
            }, 10);
            
            if (duration > 0) {
                setTimeout(() => {
                    closeAlert(alertId);
                }, duration);
            }
            
            return alertId;
        }
        
        // ปิด Alert
        function closeAlert(alertId) {
            const alertElement = document.getElementById(alertId);
            if (alertElement) {
                alertElement.classList.remove('show');
                setTimeout(() => {
                    if (alertElement.parentNode) {
                        alertElement.parentNode.removeChild(alertElement);
                    }
                }, 500);
            }
        }
        
        // แสดง Toast Notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            let icon = 'info-circle';
            let borderColor = '#3b82f6';
            
            switch(type) {
                case 'success':
                    icon = 'check-circle';
                    borderColor = '#10b981';
                    break;
                case 'error':
                    icon = 'exclamation-circle';
                    borderColor = '#ef4444';
                    break;
                case 'warning':
                    icon = 'exclamation-triangle';
                    borderColor = '#f59e0b';
                    break;
            }
            
            const toastElement = document.createElement('div');
            toastElement.id = toastId;
            toastElement.className = 'toast';
            toastElement.style.borderLeftColor = borderColor;
            toastElement.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${icon} mr-3"></i>
                    <span>${message}</span>
                </div>
            `;
            
            toastContainer.appendChild(toastElement);
            
            setTimeout(() => {
                toastElement.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toastElement.classList.remove('show');
                setTimeout(() => {
                    if (toastElement.parentNode) {
                        toastElement.parentNode.removeChild(toastElement);
                    }
                }, 500);
            }, 3000);
        }
        
        // แสดง Confirmation Dialog
        function showConfirmation(title, message, icon = 'warning', confirmText = 'ยืนยัน', cancelText = 'ยกเลิก') {
            return new Promise((resolve) => {
                const dialog = document.getElementById('confirmationDialog');
                const dialogIcon = document.getElementById('confirmationIcon');
                const dialogTitle = document.getElementById('confirmationTitle');
                const dialogMessage = document.getElementById('confirmationMessage');
                const confirmBtn = document.getElementById('confirmActionBtn');
                const cancelBtn = document.getElementById('cancelConfirmBtn');
                
                dialogTitle.textContent = title;
                dialogMessage.textContent = message;
                confirmBtn.textContent = confirmText;
                cancelBtn.textContent = cancelText;
                
                let iconClass = 'exclamation-triangle text-yellow-500';
                switch(icon) {
                    case 'success':
                        iconClass = 'check-circle text-green-500';
                        break;
                    case 'error':
                        iconClass = 'times-circle text-red-500';
                        break;
                    case 'info':
                        iconClass = 'info-circle text-blue-500';
                        break;
                    case 'question':
                        iconClass = 'question-circle text-purple-500';
                        break;
                }
                dialogIcon.innerHTML = `<i class="fas ${iconClass}"></i>`;
                
                dialog.classList.remove('hidden');
                setTimeout(() => {
                    dialog.classList.add('show');
                }, 10);
                
                const handleConfirm = () => {
                    cleanup();
                    resolve(true);
                };
                
                const handleCancel = () => {
                    cleanup();
                    resolve(false);
                };
                
                const handleKeydown = (e) => {
                    if (e.key === 'Escape') handleCancel();
                    if (e.key === 'Enter') handleConfirm();
                };
                
                const cleanup = () => {
                    dialog.classList.remove('show');
                    setTimeout(() => {
                        dialog.classList.add('hidden');
                    }, 300);
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    document.removeEventListener('keydown', handleKeydown);
                };
                
                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
                document.addEventListener('keydown', handleKeydown);
            });
        }
        
        // ==================== CORE FUNCTIONS ====================
        
        // แสดง/ซ่อน Loading Overlay
        function showLoading(message = 'กำลังโหลดข้อมูล...') {
            loadingOverlay.classList.remove('hidden');
            document.getElementById('loadingMessage').textContent = message;
        }
        
        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }
        
        // ตรวจสอบผู้ใช้และสิทธิ์
        function checkUserAndPermissions() {
            const savedUser = localStorage.getItem('inventoryUser');
            
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    console.log('Current user loaded from localStorage:', currentUser);
                    
                    // แสดงแอพพลิเคชันและซ่อนหน้าล็อกอิน
                    showApp();
                    
                    // โหลดข้อมูลทั้งหมด
                    loadAllData();
                    
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    localStorage.removeItem('inventoryUser');
                    showLogin();
                    showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการโหลดข้อมูลผู้ใช้');
                }
            } else {
                showLogin();
            }
        }
        
        // แสดงหน้าล็อกอิน
        function showLogin() {
            loginPage.classList.remove('hidden');
            appContainer.classList.add('hidden');
        }
        
        // แสดงแอพพลิเคชัน
        function showApp() {
            loginPage.classList.add('hidden');
            appContainer.classList.remove('hidden');
            
            // อัพเดทข้อมูลผู้ใช้ใน UI
            updateUserInfo();
            
            // ตั้งค่าสิทธิ์ตามบทบาท
            setupPermissions();
            
            // ตั้งค่าเริ่มต้นจาก Local Storage
            loadSettingsFromLocalStorage();
            
            // แสดง Dashboard เป็นหน้าแรก
            showPage('dashboardPage');
            
            showToast(`ยินดีต้อนรับ ${currentUser.username}!`, 'success');
            
            // สร้างรหัสการขายใหม่
            generateSaleCode();
        }
        
        // อัพเดทข้อมูลผู้ใช้ใน UI
        function updateUserInfo() {
            if (!currentUser) return;
            
            const currentUsername = document.getElementById('currentUsername');
            const welcomeUsername = document.getElementById('welcomeUsername');
            const userRoleBadge = document.getElementById('userRoleBadge');
            const userRoleText = document.getElementById('userRoleText');
            const welcomeMessage = document.getElementById('welcomeMessage');
            
            if (currentUsername) currentUsername.textContent = currentUser.username;
            if (welcomeUsername) welcomeUsername.textContent = currentUser.username;
            
            let roleDisplay = '';
            let badgeClass = '';
            
            switch(currentUser.role) {
                case 'admin':
                    roleDisplay = 'ผู้ดูแลระบบ';
                    badgeClass = 'role-admin';
                    if (welcomeMessage) welcomeMessage.textContent = 'คุณเป็นผู้ดูแลระบบ สามารถใช้งานได้ทุกฟังก์ชัน';
                    break;
                case 'manager':
                    roleDisplay = 'ผู้จัดการ';
                    badgeClass = 'role-manager';
                    if (welcomeMessage) welcomeMessage.textContent = 'คุณเป็นผู้จัดการ สามารถดูและเพิ่มข้อมูลได้ แต่ไม่สามารถลบหรือจัดการผู้ใช้ได้';
                    break;
                case 'user':
                    roleDisplay = 'ผู้ใช้ทั่วไป';
                    badgeClass = 'role-user';
                    if (welcomeMessage) welcomeMessage.textContent = 'คุณเป็นผู้ใช้ทั่วไป สามารถดูและเพิ่มข้อมูลได้ แต่ไม่สามารถลบหรือจัดการผู้ใช้ได้';
                    break;
            }
            
            if (userRoleBadge) {
                userRoleBadge.textContent = roleDisplay;
                userRoleBadge.className = `role-badge ${badgeClass}`;
            }
            if (userRoleText) userRoleText.textContent = 'ออนไลน์';
        }
        
        // ตั้งค่าสิทธิ์ตามบทบาท
        function setupPermissions() {
            if (!currentUser) return;
            
            console.log('Setting up permissions for role:', currentUser.role);
            
            const permissions = rolePermissions[currentUser.role];
            
            // ตั้งค่าปุ่มตามสิทธิ์
            const navUsers = document.getElementById('navUsers');
            const navReports = document.getElementById('navReports');
            const navSettings = document.getElementById('navSettings');
            const navSales = document.getElementById('navSales');
            const navSalesReport = document.getElementById('navSalesReport');
            
            if (navUsers) navUsers.style.display = permissions.canManageUsers ? 'flex' : 'none';
            if (navReports) navReports.style.display = permissions.canViewReports ? 'flex' : 'none';
            if (navSettings) navSettings.style.display = permissions.canManageSettings ? 'flex' : 'none';
            if (navSales) navSales.style.display = permissions.canSale ? 'flex' : 'none';
            if (navSalesReport) navSalesReport.style.display = permissions.canViewReports ? 'flex' : 'none';
            
            // อัพเดทข้อความในหน้า Products
            const productsTableInfo = document.getElementById('productsTableInfo');
            if (productsTableInfo) {
                if (permissions.canDelete) {
                    productsTableInfo.textContent = 'คุณสามารถเพิ่ม แก้ไข และลบข้อมูลสินค้าได้';
                } else {
                    productsTableInfo.textContent = 'คุณสามารถเพิ่มและแก้ไขข้อมูลสินค้าได้ แต่ไม่สามารถลบได้';
                }
            }
        }
        
        // ตรวจสอบสิทธิ์
        function checkPermission(permission) {
            if (!currentUser) return false;
            return rolePermissions[currentUser.role][permission] || false;
        }
        
        // แสดงหน้า
        function showPage(pageId) {
            // ซ่อนทุกหน้า
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.classList.add('hidden'));
            
            // แสดงหน้าที่เลือก
            const activePage = document.getElementById(pageId);
            if (activePage) {
                activePage.classList.remove('hidden');
                
                // เมื่อแสดงหน้า Dashboard ให้อัพเดทข้อมูล
                if (pageId === 'dashboardPage') {
                    updateDashboardStats();
                    updateRecentSales();
                }
                
                // เมื่อแสดงหน้า Sales ให้โหลดข้อมูลการขาย
                if (pageId === 'salesPage') {
                    loadSales();
                }
                
                // เมื่อแสดงหน้า Reports ให้โหลดรายงาน
                if (pageId === 'reportsPage') {
                    loadReports();
                }
                
                // เมื่อแสดงหน้า Sales Report ให้โหลดรายงานการขาย
                if (pageId === 'salesReportPage') {
                    generateSalesReport('today');
                }
                
                // เมื่อแสดงหน้า Settings ให้โหลดการตั้งค่า
                if (pageId === 'settingsPage') {
                    loadSettings();
                }
            }
            
            // อัพเดท Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            const activeNav = document.getElementById(`nav${pageId.replace('Page', '')}`);
            if (activeNav) {
                activeNav.classList.add('active');
            }
        }
        
        // โหลดข้อมูลทั้งหมด
        function loadAllData() {
            showLoading('กำลังโหลดข้อมูล...');
            
            Promise.all([
                loadProducts(),
                loadUsers(),
                loadSales()
            ]).then(() => {
                hideLoading();
                updateDashboardStats();
                showToast('โหลดข้อมูลสำเร็จ', 'success');
            }).catch(error => {
                hideLoading();
                showAlert('error', 'ข้อผิดพลาด', 'ไม่สามารถโหลดข้อมูลได้');
                console.error('Error loading data:', error);
            });
        }
        
        // โหลดข้อมูลสินค้า
        function loadProducts() {
            return new Promise((resolve, reject) => {
                const productsRef = database.ref('products');
                
                productsRef.on('value', (snapshot) => {
                    products = [];
                    const data = snapshot.val();
                    
                    if (data) {
                        Object.keys(data).forEach(key => {
                            products.push({
                                id: key,
                                ...data[key]
                            });
                        });
                    }
                    
                    products.sort((a, b) => a.productCode.localeCompare(b.productCode));
                    updateProductsTable();
                    resolve();
                }, (error) => {
                    console.error('Error loading products:', error);
                    reject(error);
                });
            });
        }
        
        // โหลดข้อมูลผู้ใช้
        function loadUsers() {
            return new Promise((resolve, reject) => {
                const usersRef = database.ref('users');
                
                usersRef.on('value', (snapshot) => {
                    users = [];
                    const data = snapshot.val();
                    
                    if (data) {
                        Object.keys(data).forEach(key => {
                            // ตรวจสอบว่า user มีข้อมูลครบถ้วน
                            const userData = data[key];
                            if (userData && userData.username && userData.role) {
                                users.push({
                                    id: key,
                                    ...userData
                                });
                            }
                        });
                    }
                    
                    // ตรวจสอบว่ามีผู้ใช้พื้นฐานในระบบหรือไม่
                    ensureDefaultUsers();
                    
                    updateUsersTable();
                    resolve();
                }, (error) => {
                    console.error('Error loading users:', error);
                    reject(error);
                });
            });
        }
        
        // โหลดข้อมูลการขาย
        function loadSales() {
            return new Promise((resolve, reject) => {
                const salesRef = database.ref('sales');
                
                salesRef.on('value', (snapshot) => {
                    sales = [];
                    const data = snapshot.val();
                    
                    if (data) {
                        Object.keys(data).forEach(key => {
                            sales.push({
                                id: key,
                                ...data[key]
                            });
                        });
                    }
                    
                    // เรียงลำดับตามวันที่ขาย (ใหม่ไปเก่า)
                    sales.sort((a, b) => new Date(b.saleDateTime) - new Date(a.saleDateTime));
                    
                    updateSalesTable();
                    resolve();
                }, (error) => {
                    console.error('Error loading sales:', error);
                    reject(error);
                });
            });
        }
        
        // ตรวจสอบว่ามีผู้ใช้พื้นฐานในระบบหรือไม่
        function ensureDefaultUsers() {
            const defaultUsers = [
                { username: 'admin', password: 'admin123', role: 'admin', fullName: 'ผู้ดูแลระบบ' },
                { username: 'manager', password: 'manager123', role: 'manager', fullName: 'ผู้จัดการ' },
                { username: 'user', password: 'user123', role: 'user', fullName: 'ผู้ใช้ทั่วไป' }
            ];
            
            defaultUsers.forEach(defaultUser => {
                const userExists = users.some(user => user.username === defaultUser.username);
                if (!userExists) {
                    // เพิ่มผู้ใช้พื้นฐาน
                    database.ref('users/' + defaultUser.username).set({
                        username: defaultUser.username,
                        password: defaultUser.password,
                        role: defaultUser.role,
                        fullName: defaultUser.fullName,
                        createdAt: new Date().toISOString(),
                        lastLogin: null,
                        isActive: true
                    }).then(() => {
                        console.log(`เพิ่มผู้ใช้พื้นฐาน: ${defaultUser.username}`);
                    }).catch(error => {
                        console.error(`Error adding default user ${defaultUser.username}:`, error);
                    });
                }
            });
        }
        
        // อัพเดทตารางสินค้า
        function updateProductsTable() {
            const tableBody = document.getElementById('productsTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (products.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-12 text-center text-gray-500">
                            <i class="fas fa-box-open text-4xl mb-4 animate-pulse"></i>
                            <p class="text-lg">ยังไม่มีข้อมูลสินค้า</p>
                            <p class="text-sm mt-2">คลิกปุ่ม "เพิ่มสินค้าใหม่" เพื่อเริ่มต้นบันทึกข้อมูล</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const canDelete = checkPermission('canDelete');
            
            products.forEach(product => {
                const totalValue = product.quantity * product.price;
                const isLowStock = product.quantity <= 5 && product.quantity > 0;
                const isOutOfStock = product.quantity <= 0;
                
                let statusClass = 'bg-green-900 text-green-300';
                let statusText = 'พร้อมจำหน่าย';
                let statusIcon = 'check-circle';
                
                if (isLowStock) {
                    statusClass = 'bg-yellow-900 text-yellow-300';
                    statusText = 'เหลือน้อย';
                    statusIcon = 'exclamation-triangle';
                } else if (isOutOfStock) {
                    statusClass = 'bg-red-900 text-red-300';
                    statusText = 'หมดสต๊อก';
                    statusIcon = 'times-circle';
                }
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700 transition-colors product-card';
                
                // สร้างปุ่มจัดการตามสิทธิ์
                let actionButtons = '';
                const canEdit = checkPermission('canEdit');
                
                if (canEdit) {
                    actionButtons += `
                        <button onclick="editProduct('${product.id}')" class="text-indigo-400 hover:text-indigo-300 mr-3 transition-colors hover-effect">
                            <i class="fas fa-edit mr-1"></i> แก้ไข
                        </button>
                    `;
                }
                
                if (canDelete) {
                    actionButtons += `
                        <button onclick="showDeleteProductConfirm('${product.id}', '${product.productName}')" class="text-red-400 hover:text-red-300 transition-colors hover-effect">
                            <i class="fas fa-trash-alt mr-1"></i> ลบ
                        </button>
                    `;
                } else {
                    actionButtons += `<span class="text-gray-500 text-sm"><i class="fas fa-ban mr-1"></i> ลบไม่ได้</span>`;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="font-mono font-bold text-indigo-300">${product.productCode}</span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium">${product.productName}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 bg-gray-700 rounded-full text-sm">${product.category}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="font-bold ${isOutOfStock ? 'text-red-400' : (isLowStock ? 'text-yellow-400' : 'text-green-400')}">${product.quantity.toLocaleString()}</span> ชิ้น
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ฿<span class="font-bold">${product.price.toLocaleString('th-TH', {minimumFractionDigits: 2})}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="font-bold text-lg">฿${totalValue.toLocaleString('th-TH', {minimumFractionDigits: 2})}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${statusClass} flex items-center">
                            <i class="fas fa-${statusIcon} mr-1"></i> ${statusText}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        ${actionButtons}
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // อัพเดทสถิติสินค้า
            updateProductStats();
        }
        
        // อัพเดทตารางผู้ใช้
        function updateUsersTable() {
            const tableBody = document.getElementById('usersTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (users.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                            <i class="fas fa-users text-4xl mb-4 animate-pulse"></i>
                            <p class="text-lg">ยังไม่มีข้อมูลผู้ใช้</p>
                            <p class="text-sm mt-2">คลิกปุ่ม "เพิ่มผู้ใช้ใหม่" เพื่อเริ่มต้นเพิ่มผู้ใช้</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const canManageUsers = checkPermission('canManageUsers');
            
            users.forEach(user => {
                // ตรวจสอบว่ามีข้อมูลผู้ใช้ครบถ้วน
                if (!user.username || !user.role) return;
                
                let roleBadge = '';
                let roleDisplay = '';
                
                switch(user.role) {
                    case 'admin':
                        roleBadge = 'role-admin';
                        roleDisplay = 'ผู้ดูแลระบบ';
                        break;
                    case 'manager':
                        roleBadge = 'role-manager';
                        roleDisplay = 'ผู้จัดการ';
                        break;
                    case 'user':
                        roleBadge = 'role-user';
                        roleDisplay = 'ผู้ใช้ทั่วไป';
                        break;
                    default:
                        roleBadge = 'role-user';
                        roleDisplay = 'ผู้ใช้ทั่วไป';
                }
                
                // สร้างรายการสิทธิ์
                const permissions = rolePermissions[user.role] || rolePermissions['user'];
                let permissionsHtml = '';
                
                if (permissions.canView) permissionsHtml += '<span class="permission-badge permission-allowed">ดู</span> ';
                if (permissions.canAdd) permissionsHtml += '<span class="permission-badge permission-allowed">เพิ่ม</span> ';
                if (permissions.canSale) permissionsHtml += '<span class="permission-badge permission-allowed">ขาย</span> ';
                if (permissions.canEdit) permissionsHtml += '<span class="permission-badge permission-allowed">แก้ไข</span> ';
                if (permissions.canDelete) permissionsHtml += '<span class="permission-badge permission-allowed">ลบ</span> ';
                if (permissions.canManageUsers) permissionsHtml += '<span class="permission-badge permission-allowed">ผู้ใช้</span> ';
                if (permissions.canViewReports) permissionsHtml += '<span class="permission-badge permission-allowed">รายงาน</span>';
                
                // สถานะผู้ใช้
                const status = user.isActive !== false ? 'active' : 'inactive';
                const statusText = user.isActive !== false ? 'ใช้งานได้' : 'ปิดใช้งาน';
                const statusColor = user.isActive !== false ? 'text-green-400' : 'text-red-400';
                
                // ล็อกอินล่าสุด
                const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleString('th-TH') : 'ไม่เคยล็อกอิน';
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700 transition-colors product-card';
                
                // สร้างปุ่มจัดการตามสิทธิ์
                let actionButtons = '';
                
                if (canManageUsers) {
                    actionButtons = `
                        <button onclick="editUser('${user.id}')" class="text-indigo-400 hover:text-indigo-300 mr-3 transition-colors hover-effect">
                            <i class="fas fa-edit mr-1"></i> แก้ไข
                        </button>
                    `;
                    
                    // ตรวจสอบว่าไม่ใช่ผู้ใช้ปัจจุบัน
                    if (user.id !== currentUser.username) {
                        actionButtons += `
                            <button onclick="showDeleteUserConfirm('${user.id}', '${user.fullName || user.username}')" class="text-red-400 hover:text-red-300 transition-colors hover-effect">
                                <i class="fas fa-trash-alt mr-1"></i> ลบ
                            </button>
                        `;
                    } else {
                        actionButtons += '<span class="text-gray-500 text-sm">(ผู้ใช้ปัจจุบัน)</span>';
                    }
                } else {
                    actionButtons = '<span class="text-gray-500 text-sm">ไม่สามารถจัดการได้</span>';
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-medium">${user.username}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium">${user.fullName || '-'}</div>
                        <div class="text-gray-400 text-sm">${user.email || ''}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="${roleBadge}">${roleDisplay}</span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-wrap gap-1">
                            ${permissionsHtml}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="${statusColor} font-medium">${statusText}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        ${lastLogin}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        ${actionButtons}
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // อัพเดทสถิติผู้ใช้
            updateUserStats();
        }
        
        // อัพเดทตารางการขาย
        function updateSalesTable() {
            const tableBody = document.getElementById('salesTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (sales.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                            <i class="fas fa-receipt text-4xl mb-4 animate-pulse"></i>
                            <p class="text-lg">ยังไม่มีรายการขาย</p>
                            <p class="text-sm mt-2">คลิกปุ่ม "สร้างการขายใหม่" เพื่อเริ่มต้นขายสินค้า</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            sales.forEach(sale => {
                const saleDate = new Date(sale.saleDateTime).toLocaleDateString('th-TH');
                const saleTime = new Date(sale.saleDateTime).toLocaleTimeString('th-TH');
                const itemsCount = sale.items ? sale.items.length : 0;
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700 transition-colors product-card';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="font-mono font-bold text-green-300">${sale.saleCode}</span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium">${sale.customerName || 'ลูกค้าทั่วไป'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 bg-gray-700 rounded-full text-sm">${itemsCount} รายการ</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="font-bold text-lg text-green-400">฿${sale.totalAmount.toLocaleString('th-TH', {minimumFractionDigits: 2})}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <div>${saleDate}</div>
                        <div class="text-gray-400 text-xs">${saleTime}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 bg-indigo-700 rounded-full text-xs">${sale.createdBy}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="showSaleDetail('${sale.id}')" class="text-blue-400 hover:text-blue-300 mr-3 transition-colors hover-effect">
                            <i class="fas fa-eye mr-1"></i> ดูรายละเอียด
                        </button>
                        <button onclick="showDeleteSaleConfirm('${sale.id}', '${sale.saleCode}')" class="text-red-400 hover:text-red-300 transition-colors hover-effect">
                            <i class="fas fa-trash-alt mr-1"></i> ลบ
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // อัพเดทสถิติแดชบอร์ด
        function updateDashboardStats() {
            // สินค้า
            const totalProducts = products.length;
            const totalValue = products.reduce((sum, product) => sum + (product.quantity * product.price), 0);
            const outOfStock = products.filter(p => p.quantity <= 0).length;
            
            // ยอดขายวันนี้
            const today = new Date().toLocaleDateString('th-TH');
            const todaySales = sales.filter(sale => {
                const saleDate = new Date(sale.saleDateTime).toLocaleDateString('th-TH');
                return saleDate === today;
            });
            
            const todaySalesAmount = todaySales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalValue').textContent = '฿' + totalValue.toLocaleString('th-TH', {minimumFractionDigits: 2});
            document.getElementById('outOfStock').textContent = outOfStock;
            document.getElementById('todaySales').textContent = '฿' + todaySalesAmount.toLocaleString('th-TH', {minimumFractionDigits: 2});
            
            // ผู้ใช้
            const totalUsers = users.length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
        }
        
        // อัพเดทการขายล่าสุดในแดชบอร์ด
        function updateRecentSales() {
            const recentSalesContainer = document.getElementById('recentSales');
            if (!recentSalesContainer) return;
            
            recentSalesContainer.innerHTML = '';
            
            // เอา 5 รายการล่าสุด
            const recentSalesList = sales.slice(0, 5);
            
            if (recentSalesList.length === 0) {
                recentSalesContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-receipt text-2xl mb-2"></i>
                        <p>ยังไม่มีรายการขาย</p>
                    </div>
                `;
                return;
            }
            
            recentSalesList.forEach(sale => {
                const saleDate = new Date(sale.saleDateTime).toLocaleDateString('th-TH');
                const saleTime = new Date(sale.saleDateTime).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                const itemsCount = sale.items ? sale.items.length : 0;
                
                const saleElement = document.createElement('div');
                saleElement.className = 'flex justify-between items-center p-3 bg-gray-900/50 rounded-lg hover-effect';
                saleElement.innerHTML = `
                    <div>
                        <p class="font-medium">${sale.saleCode}</p>
                        <p class="text-gray-400 text-sm">${sale.customerName || 'ลูกค้าทั่วไป'} • ${itemsCount} รายการ</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-green-400">฿${sale.totalAmount.toLocaleString('th-TH', {minimumFractionDigits: 2})}</p>
                        <p class="text-gray-400 text-sm">${saleDate} ${saleTime}</p>
                    </div>
                `;
                
                recentSalesContainer.appendChild(saleElement);
            });
        }
        
        // อัพเดทสถิติสินค้า
        function updateProductStats() {
            const totalProducts = products.length;
            const totalValue = products.reduce((sum, product) => sum + (product.quantity * product.price), 0);
            const outOfStock = products.filter(p => p.quantity <= 0).length;
            const lowStock = products.filter(p => p.quantity > 0 && p.quantity <= 5).length;
            const inStock = products.filter(p => p.quantity > 5).length;
            
            document.getElementById('totalProductsCount').textContent = totalProducts + ' รายการ';
            document.getElementById('totalProductsValue').textContent = '฿' + totalValue.toLocaleString('th-TH', {minimumFractionDigits: 2});
            document.getElementById('outOfStockCount').textContent = outOfStock + ' รายการ';
            document.getElementById('lowStockCount').textContent = lowStock;
            document.getElementById('outStockCount').textContent = outOfStock;
            document.getElementById('inStockCount').textContent = inStock;
        }
        
        // อัพเดทสถิติผู้ใช้
        function updateUserStats() {
            const totalUsers = users.length;
            const adminUsers = users.filter(u => u.role === 'admin').length;
            const managerUsers = users.filter(u => u.role === 'manager').length;
            const normalUsers = users.filter(u => u.role === 'user').length;
            
            document.getElementById('totalUsersCount').textContent = totalUsers + ' คน';
            document.getElementById('adminUsersCount').textContent = adminUsers + ' คน';
            document.getElementById('managerUsersCount').textContent = managerUsers + ' คน';
            document.getElementById('normalUsersCount').textContent = normalUsers + ' คน';
        }
        
        // ตรวจสอบการล็อกอิน
        function loginUser(username, password) {
            showLoading('กำลังตรวจสอบข้อมูลผู้ใช้...');
            
            // ตรวจสอบจาก Firebase
            database.ref('users/' + username).once('value').then(snapshot => {
                const userData = snapshot.val();
                
                if (userData && userData.password === password) {
                    // เข้าสู่ระบบสำเร็จ
                    currentUser = {
                        username: username,
                        role: userData.role || 'user',
                        fullName: userData.fullName || username
                    };
                    
                    console.log('Login successful for user:', currentUser);
                    
                    // บันทึกข้อมูลผู้ใช้ใน localStorage
                    localStorage.setItem('inventoryUser', JSON.stringify(currentUser));
                    
                    // อัพเดทข้อมูลผู้ใช้ในฐานข้อมูล (อัพเดทเวลาล็อกอินล่าสุด)
                    database.ref('users/' + username).update({
                        lastLogin: new Date().toISOString()
                    }).then(() => {
                        console.log('User login time updated:', username);
                    }).catch(error => {
                        console.error('Error updating user login time:', error);
                    });
                    
                    // แสดงแอพพลิเคชัน
                    setTimeout(() => {
                        hideLoading();
                        showApp();
                        showAlert('success', 'ล็อกอินสำเร็จ', `ยินดีต้อนรับ ${username}!`);
                    }, 1000);
                    
                } else {
                    // ล็อกอินไม่สำเร็จ
                    hideLoading();
                    showAlert('error', 'ล็อกอินไม่สำเร็จ', 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');
                }
            }).catch(error => {
                console.error('Error checking user:', error);
                hideLoading();
                showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการตรวจสอบข้อมูลผู้ใช้');
            });
        }
        
        // ==================== SALE MANAGEMENT ====================
        
        // สร้างรหัสการขาย
        function generateSaleCode() {
            const today = new Date();
            const year = today.getFullYear().toString().slice(-2);
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const day = today.getDate().toString().padStart(2, '0');
            
            // นับจำนวนการขายวันนี้
            const todaySales = sales.filter(sale => {
                const saleDate = new Date(sale.saleDateTime);
                return saleDate.getDate() === today.getDate() &&
                       saleDate.getMonth() === today.getMonth() &&
                       saleDate.getFullYear() === today.getFullYear();
            });
            
            const saleNumber = (todaySales.length + 1).toString().padStart(3, '0');
            const saleCode = `SALE-${year}${month}${day}-${saleNumber}`;
            
            document.getElementById('saleCode').value = saleCode;
            return saleCode;
        }
        
        // เพิ่มรายการสินค้าในฟอร์มขาย
        function addSaleItem() {
            if (products.length === 0) {
                showAlert('warning', 'ไม่มีสินค้า', 'ไม่มีสินค้าในระบบ กรุณาเพิ่มสินค้าก่อน');
                return;
            }
            
            const saleItemsContainer = document.getElementById('saleItemsContainer');
            const itemId = Date.now();
            
            const itemElement = document.createElement('div');
            itemElement.className = 'sale-item';
            itemElement.id = `saleItem-${itemId}`;
            itemElement.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h5 class="font-medium">รายการสินค้า</h5>
                    <button type="button" onclick="removeSaleItem(${itemId})" class="text-red-400 hover:text-red-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">สินค้า</label>
                        <select class="sale-product-select w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300" onchange="updateSaleItemPrice(${itemId})">
                            <option value="">เลือกสินค้า</option>
                            ${products.filter(p => p.quantity > 0).map(product => `
                                <option value="${product.id}" data-price="${product.price}" data-stock="${product.quantity}">${product.productCode} - ${product.productName} (เหลือ: ${product.quantity})</option>
                            `).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">จำนวน</label>
                        <input type="number" min="1" value="1" class="sale-quantity w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300" oninput="updateSaleItemTotal(${itemId})">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">ราคาต่อหน่วย</label>
                        <input type="number" min="0" step="0.01" class="sale-price w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">รวม</label>
                        <input type="number" class="sale-total w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300" readonly>
                    </div>
                </div>
            `;
            
            saleItemsContainer.appendChild(itemElement);
            updateSaleSummary();
        }
        
        // ลบรายการสินค้าในฟอร์มขาย
        function removeSaleItem(itemId) {
            const itemElement = document.getElementById(`saleItem-${itemId}`);
            if (itemElement) {
                itemElement.remove();
                updateSaleSummary();
            }
        }
        
        // อัพเดทราคาสินค้าในรายการขาย
        function updateSaleItemPrice(itemId) {
            const itemElement = document.getElementById(`saleItem-${itemId}`);
            if (!itemElement) return;
            
            const productSelect = itemElement.querySelector('.sale-product-select');
            const priceInput = itemElement.querySelector('.sale-price');
            const quantityInput = itemElement.querySelector('.sale-quantity');
            const totalInput = itemElement.querySelector('.sale-total');
            
            const selectedOption = productSelect.options[productSelect.selectedIndex];
            if (selectedOption && selectedOption.value) {
                const price = parseFloat(selectedOption.getAttribute('data-price')) || 0;
                const stock = parseInt(selectedOption.getAttribute('data-stock')) || 0;
                
                priceInput.value = price.toFixed(2);
                
                // ตรวจสอบว่าจำนวนที่ต้องการขายมีในสต๊อกหรือไม่
                const quantity = parseInt(quantityInput.value) || 1;
                if (quantity > stock) {
                    quantityInput.value = stock;
                    showAlert('warning', 'จำนวนไม่เพียงพอ', `สินค้านี้เหลือเพียง ${stock} ชิ้นในสต๊อก`);
                }
                
                updateSaleItemTotal(itemId);
            } else {
                priceInput.value = '';
                totalInput.value = '';
            }
        }
        
        // อัพเดทยอดรวมของรายการขาย
        function updateSaleItemTotal(itemId) {
            const itemElement = document.getElementById(`saleItem-${itemId}`);
            if (!itemElement) return;
            
            const priceInput = itemElement.querySelector('.sale-price');
            const quantityInput = itemElement.querySelector('.sale-quantity');
            const totalInput = itemElement.querySelector('.sale-total');
            
            const price = parseFloat(priceInput.value) || 0;
            const quantity = parseInt(quantityInput.value) || 0;
            
            totalInput.value = (price * quantity).toFixed(2);
            updateSaleSummary();
        }
        
        // อัพเดทสรุปรายการขาย
        function updateSaleSummary() {
            const saleItems = document.querySelectorAll('.sale-item');
            let totalItems = 0;
            let totalQuantity = 0;
            let totalAmount = 0;
            
            saleItems.forEach(item => {
                const quantityInput = item.querySelector('.sale-quantity');
                const totalInput = item.querySelector('.sale-total');
                const productSelect = item.querySelector('.sale-product-select');
                
                if (productSelect.value) {
                    totalItems++;
                    totalQuantity += parseInt(quantityInput.value) || 0;
                    totalAmount += parseFloat(totalInput.value) || 0;
                }
            });
            
            document.getElementById('totalItemsCount').textContent = totalItems;
            document.getElementById('totalQuantityCount').textContent = totalQuantity + ' ชิ้น';
            document.getElementById('totalSaleAmount').textContent = '฿' + totalAmount.toFixed(2);
        }
        
        // ล้างฟอร์มขาย
        function clearSaleForm() {
            showConfirmation(
                'ล้างรายการขาย',
                'คุณแน่ใจหรือไม่ว่าต้องการล้างรายการขายทั้งหมด?',
                'warning',
                'ล้างรายการ',
                'ยกเลิก'
            ).then(confirmed => {
                if (confirmed) {
                    document.getElementById('saleItemsContainer').innerHTML = '';
                    document.getElementById('customerName').value = '';
                    generateSaleCode();
                    updateSaleSummary();
                    showToast('ล้างรายการขายเรียบร้อยแล้ว', 'success');
                }
            });
        }
        
        // บันทึกรายการขาย
        function saveSale(e) {
            e.preventDefault();
            
            // ตรวจสอบว่ามีรายการสินค้าหรือไม่
            const saleItems = document.querySelectorAll('.sale-item');
            if (saleItems.length === 0) {
                showAlert('error', 'ไม่มีรายการสินค้า', 'กรุณาเพิ่มรายการสินค้าก่อนบันทึกการขาย');
                return;
            }
            
            // ตรวจสอบว่าทุกรายการมีสินค้าเลือกแล้ว
            let isValid = true;
            const saleDataItems = [];
            
            saleItems.forEach(item => {
                const productSelect = item.querySelector('.sale-product-select');
                const quantityInput = item.querySelector('.sale-quantity');
                const priceInput = item.querySelector('.sale-price');
                
                if (!productSelect.value) {
                    isValid = false;
                    return;
                }
                
                // ตรวจสอบว่ามีสินค้าพอในสต๊อกหรือไม่
                const productId = productSelect.value;
                const selectedOption = productSelect.options[productSelect.selectedIndex];
                const stock = parseInt(selectedOption.getAttribute('data-stock')) || 0;
                const quantity = parseInt(quantityInput.value) || 0;
                
                if (quantity > stock) {
                    showAlert('error', 'จำนวนไม่เพียงพอ', `สินค้า ${selectedOption.text} มีเพียง ${stock} ชิ้นในสต๊อก`);
                    isValid = false;
                    return;
                }
                
                if (quantity <= 0) {
                    showAlert('error', 'จำนวนไม่ถูกต้อง', 'กรุณากรอกจำนวนสินค้าให้ถูกต้อง');
                    isValid = false;
                    return;
                }
                
                // ค้นหาข้อมูลสินค้า
                const product = products.find(p => p.id === productId);
                if (!product) {
                    isValid = false;
                    return;
                }
                
                saleDataItems.push({
                    productId: productId,
                    productCode: product.productCode,
                    productName: product.productName,
                    quantity: quantity,
                    price: parseFloat(priceInput.value) || 0,
                    total: quantity * parseFloat(priceInput.value)
                });
            });
            
            if (!isValid) {
                showAlert('error', 'ข้อมูลไม่ถูกต้อง', 'กรุณาตรวจสอบข้อมูลรายการสินค้าให้ครบถ้วนและถูกต้อง');
                return;
            }
            
            // คำนวณยอดรวม
            const totalAmount = saleDataItems.reduce((sum, item) => sum + item.total, 0);
            
            // ข้อมูลการขาย
            const saleData = {
                saleCode: document.getElementById('saleCode').value,
                customerName: document.getElementById('customerName').value.trim() || 'ลูกค้าทั่วไป',
                items: saleDataItems,
                totalAmount: totalAmount,
                saleDate: new Date().toLocaleDateString('th-TH'),
                saleDateTime: new Date().toISOString(),
                createdBy: currentUser.username,
                createdAt: new Date().toISOString()
            };
            
            showLoading('กำลังบันทึกการขาย...');
            
            // บันทึกข้อมูลการขาย
            database.ref('sales').push(saleData)
                .then((ref) => {
                    // อัพเดทจำนวนสินค้าในสต๊อก
                    const updatePromises = saleDataItems.map(item => {
                        const product = products.find(p => p.id === item.productId);
                        if (product) {
                            const newQuantity = product.quantity - item.quantity;
                            return database.ref('products/' + item.productId).update({
                                quantity: newQuantity
                            });
                        }
                        return Promise.resolve();
                    });
                    
                    return Promise.all(updatePromises).then(() => ref.key);
                })
                .then((saleId) => {
                    hideLoading();
                    
                    // ล้างฟอร์ม
                    document.getElementById('saleItemsContainer').innerHTML = '';
                    document.getElementById('customerName').value = '';
                    generateSaleCode();
                    updateSaleSummary();
                    
                    // แสดงใบเสร็จ
                    showSaleDetail(saleId);
                    
                    showAlert('success', 'บันทึกการขายสำเร็จ', `บันทึกรายการขาย ${saleData.saleCode} เรียบร้อยแล้ว`);
                    
                    // โหลดข้อมูลใหม่
                    loadProducts();
                    loadSales();
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error saving sale:', error);
                    showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการบันทึกการขาย');
                });
        }
        
        // แสดงรายละเอียดการขาย
        function showSaleDetail(saleId) {
            const sale = sales.find(s => s.id === saleId);
            if (!sale) {
                // ถ้าไม่เจอในรายการ sales (อาจเป็นรายการที่เพิ่งบันทึก)
                database.ref('sales/' + saleId).once('value').then(snapshot => {
                    const saleData = snapshot.val();
                    if (saleData) {
                        displaySaleDetail({ id: saleId, ...saleData });
                    }
                });
                return;
            }
            
            displaySaleDetail(sale);
        }
        
        // แสดงรายละเอียดการขายใน Modal
        function displaySaleDetail(sale) {
            const modal = document.getElementById('saleDetailModal');
            const modalTitle = document.getElementById('modalSaleTitle');
            const saleDetailCode = document.getElementById('saleDetailCode');
            const saleDetailCustomer = document.getElementById('saleDetailCustomer');
            const saleDetailDate = document.getElementById('saleDetailDate');
            const saleDetailStaff = document.getElementById('saleDetailStaff');
            const saleDetailItems = document.getElementById('saleDetailItems');
            const saleDetailTotal = document.getElementById('saleDetailTotal');
            
            modalTitle.textContent = `รายละเอียดการขาย: ${sale.saleCode}`;
            saleDetailCode.textContent = sale.saleCode;
            saleDetailCustomer.textContent = sale.customerName;
            saleDetailDate.textContent = `${sale.saleDate} ${new Date(sale.saleDateTime).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })}`;
            saleDetailStaff.textContent = sale.createdBy;
            saleDetailTotal.textContent = `฿${sale.totalAmount.toLocaleString('th-TH', {minimumFractionDigits: 2})}`;
            
            // รายการสินค้า
            saleDetailItems.innerHTML = '';
            if (sale.items && sale.items.length > 0) {
                sale.items.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between items-center p-3 bg-gray-900/50 rounded-lg';
                    itemElement.innerHTML = `
                        <div>
                            <p class="font-medium">${item.productName}</p>
                            <p class="text-gray-400 text-sm">${item.productCode} • ${item.quantity} ชิ้น</p>
                        </div>
                        <div class="text-right">
                            <p class="font-medium">฿${item.price.toLocaleString('th-TH', {minimumFractionDigits: 2})}</p>
                            <p class="text-green-400 font-bold">฿${item.total.toLocaleString('th-TH', {minimumFractionDigits: 2})}</p>
                        </div>
                    `;
                    saleDetailItems.appendChild(itemElement);
                });
            } else {
                saleDetailItems.innerHTML = '<p class="text-gray-500 text-center py-4">ไม่มีรายการสินค้า</p>';
            }
            
            modal.classList.remove('hidden');
        }
        
        // แสดง Confirmation สำหรับลบรายการขาย
        function showDeleteSaleConfirm(saleId, saleCode) {
            saleToDelete = saleId;
            
            showConfirmation(
                'ยืนยันการลบรายการขาย',
                `คุณแน่ใจหรือไม่ว่าต้องการลบรายการขาย "${saleCode}"? การกระทำนี้ไม่สามารถย้อนกลับได้`,
                'warning',
                'ลบข้อมูล',
                'ยกเลิก'
            ).then(confirmed => {
                if (confirmed) {
                    deleteSale();
                } else {
                    saleToDelete = null;
                }
            });
        }
        
        // ลบรายการขาย
        function deleteSale() {
            if (!saleToDelete) return;
            
            showLoading('กำลังลบรายการขาย...');
            
            database.ref('sales/' + saleToDelete).remove()
                .then(() => {
                    hideLoading();
                    showAlert('success', 'ลบสำเร็จ', 'ลบรายการขายเรียบร้อยแล้ว');
                    saleToDelete = null;
                    
                    // โหลดข้อมูลใหม่
                    loadSales();
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error deleting sale:', error);
                    showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการลบรายการขาย');
                    saleToDelete = null;
                });
        }
        
        // ==================== SALES REPORT ====================
        
        // สร้างรายงานการขาย
        function generateSalesReport(period) {
            let startDate, endDate;
            const today = new Date();
            
            switch(period) {
                case 'today':
                    startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59);
                    break;
                case 'yesterday':
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    startDate = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());
                    endDate = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), 23, 59, 59);
                    break;
                case 'week':
                    const firstDayOfWeek = new Date(today);
                    firstDayOfWeek.setDate(today.getDate() - today.getDay());
                    startDate = new Date(firstDayOfWeek.getFullYear(), firstDayOfWeek.getMonth(), firstDayOfWeek.getDate());
                    endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59);
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0, 23, 59, 59);
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = new Date(today.getFullYear(), 11, 31, 23, 59, 59);
                    break;
                case 'custom':
                    const customStartDate = document.getElementById('startDate').value;
                    const customEndDate = document.getElementById('endDate').value;
                    
                    if (!customStartDate || !customEndDate) {
                        showAlert('error', 'ข้อมูลไม่ครบถ้วน', 'กรุณาเลือกวันที่เริ่มต้นและสิ้นสุด');
                        return;
                    }
                    
                    startDate = new Date(customStartDate);
                    endDate = new Date(customEndDate);
                    endDate.setHours(23, 59, 59);
                    break;
            }
            
            // กรองข้อมูลการขายตามช่วงเวลา
            const filteredSales = sales.filter(sale => {
                const saleDate = new Date(sale.saleDateTime);
                return saleDate >= startDate && saleDate <= endDate;
            });
            
            // อัพเดทสถิติ
            updateSalesReportStats(filteredSales);
            
            // สร้างกราฟ
            createSalesCharts(filteredSales, startDate, endDate);
            
            // แสดงสินค้าขายดี
            updateTopProductsList(filteredSales);
        }
        
        // อัพเดทสถิติรายงานการขาย
        function updateSalesReportStats(filteredSales) {
            const totalSalesCount = filteredSales.length;
            const totalSalesAmount = filteredSales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            
            // นับจำนวนสินค้าทั้งหมดที่ขาย
            let totalSoldItems = 0;
            filteredSales.forEach(sale => {
                if (sale.items) {
                    totalSoldItems += sale.items.reduce((sum, item) => sum + item.quantity, 0);
                }
            });
            
            const averageSaleAmount = totalSalesCount > 0 ? totalSalesAmount / totalSalesCount : 0;
            
            document.getElementById('totalSalesCount').textContent = totalSalesCount + ' รายการ';
            document.getElementById('totalSalesAmount').textContent = '฿' + totalSalesAmount.toLocaleString('th-TH', {minimumFractionDigits: 2});
            document.getElementById('totalSoldItems').textContent = totalSoldItems + ' ชิ้น';
            document.getElementById('averageSaleAmount').textContent = '฿' + averageSaleAmount.toLocaleString('th-TH', {minimumFractionDigits: 2});
        }
        
        // สร้างกราฟรายงานการขาย
        function createSalesCharts(filteredSales, startDate, endDate) {
            // กราฟยอดขายรายวัน
            createDailySalesChart(filteredSales, startDate, endDate);
            
            // กราฟประเภทสินค้าขายดี
            createProductCategoryChart(filteredSales);
        }
        
        // สร้างกราฟยอดขายรายวัน
        function createDailySalesChart(filteredSales, startDate, endDate) {
            const ctx = document.getElementById('dailySalesChart').getContext('2d');
            
            // สร้างข้อมูลรายวัน
            const days = [];
            const salesData = [];
            
            // คำนวณช่วงวันที่
            const currentDate = new Date(startDate);
            const endDateObj = new Date(endDate);
            
            while (currentDate <= endDateObj) {
                const dateStr = currentDate.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });
                days.push(dateStr);
                
                // คำนวณยอดขายของวันนั้น
                const daySales = filteredSales.filter(sale => {
                    const saleDate = new Date(sale.saleDateTime);
                    return saleDate.getDate() === currentDate.getDate() &&
                           saleDate.getMonth() === currentDate.getMonth() &&
                           saleDate.getFullYear() === currentDate.getFullYear();
                });
                
                const dayTotal = daySales.reduce((sum, sale) => sum + sale.totalAmount, 0);
                salesData.push(dayTotal);
                
                // เพิ่ม 1 วัน
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // ทำลายกราฟเดิม (ถ้ามี)
            if (dailySalesChart) {
                dailySalesChart.destroy();
            }
            
            // สร้างกราฟใหม่
            dailySalesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'ยอดขาย (บาท)',
                        data: salesData,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#9ca3af'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(156, 163, 175, 0.2)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(156, 163, 175, 0.2)'
                            },
                            ticks: {
                                color: '#9ca3af',
                                callback: function(value) {
                                    return '฿' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // สร้างกราฟประเภทสินค้าขายดี
        function createProductCategoryChart(filteredSales) {
            const ctx = document.getElementById('productCategoryChart').getContext('2d');
            
            // รวบรวมข้อมูลตามประเภทสินค้า
            const categorySales = {};
            
            filteredSales.forEach(sale => {
                if (sale.items) {
                    sale.items.forEach(item => {
                        // ค้นหาข้อมูลสินค้า
                        const product = products.find(p => p.id === item.productId);
                        if (product) {
                            const category = product.category || 'อื่นๆ';
                            if (!categorySales[category]) {
                                categorySales[category] = 0;
                            }
                            categorySales[category] += item.total;
                        }
                    });
                }
            });
            
            // จัดเรียงข้อมูล
            const categories = Object.keys(categorySales);
            const salesByCategory = categories.map(category => categorySales[category]);
            
            // สีสำหรับแต่ละประเภท
            const backgroundColors = [
                'rgba(59, 130, 246, 0.7)',
                'rgba(16, 185, 129, 0.7)',
                'rgba(245, 158, 11, 0.7)',
                'rgba(139, 92, 246, 0.7)',
                'rgba(239, 68, 68, 0.7)',
                'rgba(14, 165, 233, 0.7)'
            ];
            
            // ทำลายกราฟเดิม (ถ้ามี)
            if (productCategoryChart) {
                productCategoryChart.destroy();
            }
            
            // สร้างกราฟใหม่
            productCategoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'ยอดขายตามประเภท',
                        data: salesByCategory,
                        backgroundColor: backgroundColors.slice(0, categories.length),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#9ca3af'
                            }
                        }
                    }
                }
            });
        }
        
        // อัพเดทรายการสินค้าขายดี
        function updateTopProductsList(filteredSales) {
            const topProductsList = document.getElementById('topProductsList');
            
            // รวบรวมข้อมูลสินค้าขายดี
            const productSales = {};
            
            filteredSales.forEach(sale => {
                if (sale.items) {
                    sale.items.forEach(item => {
                        const productId = item.productId;
                        if (!productSales[productId]) {
                            productSales[productId] = {
                                productId: productId,
                                productCode: item.productCode,
                                productName: item.productName,
                                totalQuantity: 0,
                                totalAmount: 0
                            };
                        }
                        productSales[productId].totalQuantity += item.quantity;
                        productSales[productId].totalAmount += item.total;
                    });
                }
            });
            
            // แปลงเป็น array และเรียงลำดับตามยอดขาย
            const topProducts = Object.values(productSales)
                .sort((a, b) => b.totalAmount - a.totalAmount)
                .slice(0, 5); // เอา 5 อันดับแรก
            
            // แสดงผล
            if (topProducts.length === 0) {
                topProductsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-chart-bar text-2xl mb-2"></i>
                        <p>ยังไม่มีข้อมูลสินค้าขายดี</p>
                    </div>
                `;
                return;
            }
            
            topProductsList.innerHTML = '';
            topProducts.forEach((product, index) => {
                const productElement = document.createElement('div');
                productElement.className = 'flex justify-between items-center p-4 bg-gray-900/50 rounded-lg hover-effect';
                productElement.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-white font-bold mr-3">${index + 1}</span>
                        <div>
                            <p class="font-medium">${product.productName}</p>
                            <p class="text-gray-400 text-sm">${product.productCode} • ขายได้ ${product.totalQuantity} ชิ้น</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-green-400">฿${product.totalAmount.toLocaleString('th-TH', {minimumFractionDigits: 2})}</p>
                    </div>
                `;
                topProductsList.appendChild(productElement);
            });
        }
        
        // ส่งออกรายงานการขาย
        function exportSalesReport() {
            const period = document.getElementById('reportPeriod').value;
            let startDate, endDate;
            const today = new Date();
            
            switch(period) {
                case 'today':
                    startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59);
                    break;
                case 'yesterday':
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    startDate = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());
                    endDate = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), 23, 59, 59);
                    break;
                case 'week':
                    const firstDayOfWeek = new Date(today);
                    firstDayOfWeek.setDate(today.getDate() - today.getDay());
                    startDate = new Date(firstDayOfWeek.getFullYear(), firstDayOfWeek.getMonth(), firstDayOfWeek.getDate());
                    endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59);
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0, 23, 59, 59);
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = new Date(today.getFullYear(), 11, 31, 23, 59, 59);
                    break;
                case 'custom':
                    const customStartDate = document.getElementById('startDate').value;
                    const customEndDate = document.getElementById('endDate').value;
                    
                    if (!customStartDate || !customEndDate) {
                        showAlert('error', 'ข้อมูลไม่ครบถ้วน', 'กรุณาเลือกวันที่เริ่มต้นและสิ้นสุด');
                        return;
                    }
                    
                    startDate = new Date(customStartDate);
                    endDate = new Date(customEndDate);
                    endDate.setHours(23, 59, 59);
                    break;
            }
            
            // กรองข้อมูลการขายตามช่วงเวลา
            const filteredSales = sales.filter(sale => {
                const saleDate = new Date(sale.saleDateTime);
                return saleDate >= startDate && saleDate <= endDate;
            });
            
            if (filteredSales.length === 0) {
                showAlert('warning', 'ไม่มีข้อมูล', 'ไม่มีข้อมูลการขายในช่วงเวลาที่เลือก');
                return;
            }
            
            showLoading('กำลังสร้างรายงานการขาย...');
            
            // สร้างข้อมูล CSV
            let csvContent = "รหัสการขาย,ลูกค้า,จำนวนรายการ,ยอดรวม,วันที่ขาย,พนักงานขาย\n";
            
            filteredSales.forEach(sale => {
                const itemsCount = sale.items ? sale.items.length : 0;
                const saleDate = new Date(sale.saleDateTime).toLocaleDateString('th-TH');
                
                csvContent += `"${sale.saleCode}","${sale.customerName || 'ลูกค้าทั่วไป'}",${itemsCount},${sale.totalAmount},"${saleDate}","${sale.createdBy}"\n`;
            });
            
            // สร้างไฟล์และดาวน์โหลด
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", `รายงานการขาย_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            hideLoading();
            showAlert('success', 'ส่งออกสำเร็จ', 'ส่งออกรายงานการขายเป็นไฟล์ CSV เรียบร้อยแล้ว');
        }
        
        // พิมพ์ใบเสร็จ
        function printReceipt() {
            const saleCode = document.getElementById('saleDetailCode').textContent;
            const customerName = document.getElementById('saleDetailCustomer').textContent;
            const saleDate = document.getElementById('saleDetailDate').textContent;
            const saleTotal = document.getElementById('saleDetailTotal').textContent;
            
            // สร้างใบเสร็จ
            const receiptContent = document.getElementById('receiptContent');
            receiptContent.innerHTML = `
                <div class="receipt-header">
                    <h2>ใบเสร็จรับเงิน</h2>
                    <p>ระบบจัดการขายสินค้า</p>
                    <p>${saleDate}</p>
                </div>
                <div class="mb-4">
                    <div class="receipt-item">
                        <span>รหัสการขาย:</span>
                        <span>${saleCode}</span>
                    </div>
                    <div class="receipt-item">
                        <span>ลูกค้า:</span>
                        <span>${customerName}</span>
                    </div>
                </div>
                <div class="mb-4">
                    <h4>รายการสินค้า</h4>
                    <div id="receiptItems">
                        <!-- Items will be added here -->
                    </div>
                </div>
                <div class="receipt-total">
                    <div class="receipt-item">
                        <span>รวมทั้งสิ้น:</span>
                        <span>${saleTotal}</span>
                    </div>
                </div>
                <div class="mt-8 text-center">
                    <p>ขอบคุณที่ใช้บริการ</p>
                    <p>ระบบจัดการขายสินค้า</p>
                </div>
            `;
            
            // เพิ่มรายการสินค้า
            const receiptItems = document.getElementById('receiptItems');
            const saleItemsContainer = document.getElementById('saleDetailItems');
            const items = saleItemsContainer.querySelectorAll('.bg-gray-900\\/50');
            
            items.forEach(item => {
                const itemName = item.querySelector('.font-medium').textContent;
                const itemDetails = item.querySelector('.text-gray-400').textContent;
                const itemTotal = item.querySelector('.text-green-400').textContent;
                
                const itemElement = document.createElement('div');
                itemElement.className = 'receipt-item';
                itemElement.innerHTML = `
                    <div>
                        <span>${itemName}</span>
                        <br>
                        <small>${itemDetails}</small>
                    </div>
                    <span>${itemTotal}</span>
                `;
                receiptItems.appendChild(itemElement);
            });
            
            // แสดงส่วนพิมพ์
            const printSection = document.getElementById('printReceiptSection');
            printSection.classList.remove('hidden');
            
            // พิมพ์
            window.print();
            
            // ซ่อนส่วนพิมพ์หลังพิมพ์เสร็จ
            setTimeout(() => {
                printSection.classList.add('hidden');
            }, 500);
        }
        
        // ==================== PRODUCT MANAGEMENT ====================
        
        // แสดง Modal สำหรับเพิ่ม/แก้ไขสินค้า
        function showProductModal(product = null) {
            const modal = document.getElementById('productModal');
            const modalTitle = document.getElementById('modalProductTitle');
            const productId = document.getElementById('productId');
            const productCode = document.getElementById('productCode');
            const productName = document.getElementById('productName');
            const productCategory = document.getElementById('productCategory');
            const productQuantity = document.getElementById('productQuantity');
            const productPrice = document.getElementById('productPrice');
            
            if (product) {
                modalTitle.textContent = 'แก้ไขข้อมูลสินค้า';
                productId.value = product.id;
                productCode.value = product.productCode;
                productName.value = product.productName;
                productCategory.value = product.category;
                productQuantity.value = product.quantity;
                productPrice.value = product.price;
            } else {
                modalTitle.textContent = 'เพิ่มสินค้าใหม่';
                productId.value = '';
                productCode.value = '';
                productName.value = '';
                productCategory.value = '';
                productQuantity.value = '';
                productPrice.value = '';
            }
            
            modal.classList.remove('hidden');
        }
        
        // ซ่อน Product Modal
        function hideProductModal() {
            document.getElementById('productModal').classList.add('hidden');
        }
        
        // บันทึกสินค้า
        function saveProduct(e) {
            e.preventDefault();
            
            const productId = document.getElementById('productId').value;
            const productCode = document.getElementById('productCode').value.trim();
            const productName = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value;
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const price = parseFloat(document.getElementById('productPrice').value);
            
            // ตรวจสอบข้อมูล
            if (!productCode || !productName || !category || isNaN(quantity) || isNaN(price)) {
                showAlert('error', 'ข้อมูลไม่ครบถ้วน', 'กรุณากรอกข้อมูลให้ครบถ้วนและถูกต้อง');
                return;
            }
            
            if (quantity < 0) {
                showAlert('error', 'ข้อมูลไม่ถูกต้อง', 'จำนวนสินค้าไม่สามารถเป็นลบได้');
                return;
            }
            
            if (price < 0) {
                showAlert('error', 'ข้อมูลไม่ถูกต้อง', 'ราคาสินค้าไม่สามารถเป็นลบได้');
                return;
            }
            
            const productData = {
                productCode,
                productName,
                category,
                quantity,
                price,
                updatedBy: currentUser.username,
                updatedAt: new Date().toISOString()
            };
            
            // บันทึกลง Firebase
            if (productId) {
                // อัพเดทข้อมูลที่มีอยู่
                database.ref('products/' + productId).update(productData)
                    .then(() => {
                        hideProductModal();
                        showAlert('success', 'อัพเดทสำเร็จ', 'อัพเดทข้อมูลสินค้าเรียบร้อยแล้ว');
                    })
                    .catch(error => {
                        console.error('Error updating product:', error);
                        showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการอัพเดทข้อมูล');
                    });
            } else {
                // เพิ่มข้อมูลใหม่
                // ตรวจสอบว่ามีรหัสสินค้าซ้ำหรือไม่
                const isDuplicate = products.some(product => product.productCode === productCode);
                if (isDuplicate) {
                    showAlert('error', 'ข้อมูลซ้ำ', 'รหัสสินค้านี้มีอยู่ในระบบแล้ว กรุณาใช้รหัสอื่น');
                    return;
                }
                
                // เพิ่มข้อมูลผู้สร้าง
                productData.createdBy = currentUser.username;
                productData.createdAt = new Date().toISOString();
                
                database.ref('products').push(productData)
                    .then(() => {
                        hideProductModal();
                        showAlert('success', 'เพิ่มสำเร็จ', 'เพิ่มข้อมูลสินค้าใหม่เรียบร้อยแล้ว');
                    })
                    .catch(error => {
                        console.error('Error adding product:', error);
                        showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการเพิ่มข้อมูล');
                    });
            }
        }
        
        // แก้ไขสินค้า
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                showProductModal(product);
            }
        }
        
        // แสดง Confirmation สำหรับลบสินค้า
        function showDeleteProductConfirm(productId, productName) {
            // ตรวจสอบสิทธิ์ก่อนแสดง
            if (!checkPermission('canDelete')) {
                showAlert('error', 'ไม่มีสิทธิ์', 'ขออภัย คุณไม่มีสิทธิ์ลบข้อมูลสินค้า');
                return;
            }
            
            productToDelete = productId;
            
            showConfirmation(
                'ยืนยันการลบข้อมูลสินค้า',
                `คุณแน่ใจหรือไม่ว่าต้องการลบสินค้า "${productName}"? การกระทำนี้ไม่สามารถย้อนกลับได้`,
                'warning',
                'ลบข้อมูล',
                'ยกเลิก'
            ).then(confirmed => {
                if (confirmed) {
                    deleteProduct();
                } else {
                    productToDelete = null;
                }
            });
        }
        
        // ลบสินค้า
        function deleteProduct() {
            if (!productToDelete || !checkPermission('canDelete')) {
                showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์ลบข้อมูลสินค้า');
                return;
            }
            
            showLoading('กำลังลบข้อมูลสินค้า...');
            
            database.ref('products/' + productToDelete).remove()
                .then(() => {
                    hideLoading();
                    showAlert('success', 'ลบสำเร็จ', 'ลบข้อมูลสินค้าเรียบร้อยแล้ว');
                    productToDelete = null;
                })
                .catch(error => {
                    console.error('Error deleting product:', error);
                    hideLoading();
                    showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการลบข้อมูล');
                    productToDelete = null;
                });
        }
        
        // ==================== USER MANAGEMENT ====================
        
        // แสดง Modal สำหรับเพิ่ม/แก้ไขผู้ใช้
        function showUserModal(user = null) {
            // ตรวจสอบสิทธิ์
            if (!checkPermission('canManageUsers')) {
                showAlert('error', 'ไม่มีสิทธิ์', 'ขออภัย คุณไม่มีสิทธิ์จัดการผู้ใช้');
                return;
            }
            
            const modal = document.getElementById('userModal');
            const modalTitle = document.getElementById('modalUserTitle');
            const userId = document.getElementById('userId');
            const newUsername = document.getElementById('newUsername');
            const newPassword = document.getElementById('newPassword');
            const fullName = document.getElementById('fullName');
            const userRole = document.getElementById('userRole');
            
            // ตั้งค่าสิทธิ์ตามบทบาท
            const updatePermissions = (role) => {
                const permissions = rolePermissions[role] || rolePermissions['user'];
                document.getElementById('permView').checked = permissions.canView || false;
                document.getElementById('permAdd').checked = permissions.canAdd || false;
                document.getElementById('permSale').checked = permissions.canSale || false;
                document.getElementById('permEdit').checked = permissions.canEdit || false;
                document.getElementById('permDelete').checked = permissions.canDelete || false;
                document.getElementById('permManageUsers').checked = permissions.canManageUsers || false;
                document.getElementById('permViewReports').checked = permissions.canViewReports || false;
                
                // Disable permission checkboxes (permissions are based on role)
                document.querySelectorAll('#userModal input[type="checkbox"]').forEach(cb => {
                    cb.disabled = true;
                });
            };
            
            if (user) {
                modalTitle.textContent = 'แก้ไขข้อมูลผู้ใช้';
                userId.value = user.id;
                newUsername.value = user.username;
                newUsername.disabled = true;
                newPassword.required = false;
                newPassword.placeholder = 'เว้นว่างหากไม่ต้องการเปลี่ยนรหัสผ่าน';
                fullName.value = user.fullName || '';
                userRole.value = user.role || 'user';
                
                updatePermissions(user.role || 'user');
            } else {
                modalTitle.textContent = 'เพิ่มผู้ใช้ใหม่';
                userId.value = '';
                newUsername.value = '';
                newUsername.disabled = false;
                newPassword.required = true;
                newPassword.placeholder = 'กรอกรหัสผ่าน';
                fullName.value = '';
                userRole.value = 'user';
                
                updatePermissions('user');
            }
            
            userRole.addEventListener('change', function() {
                updatePermissions(this.value);
            });
            
            modal.classList.remove('hidden');
        }
        
        // ซ่อน User Modal
        function hideUserModal() {
            document.getElementById('userModal').classList.add('hidden');
        }
        
        // บันทึกผู้ใช้
        function saveUser(e) {
            e.preventDefault();
            
            if (!checkPermission('canManageUsers')) {
                showAlert('error', 'ไม่มีสิทธิ์', 'ขออภัย คุณไม่มีสิทธิ์จัดการผู้ใช้');
                return;
            }
            
            const userId = document.getElementById('userId').value;
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const fullName = document.getElementById('fullName').value.trim();
            const role = document.getElementById('userRole').value;
            
            if (!username || !role) {
                showAlert('error', 'ข้อมูลไม่ครบถ้วน', 'กรุณากรอกชื่อผู้ใช้และบทบาท');
                return;
            }
            
            if (!userId && !password) {
                showAlert('error', 'ข้อมูลไม่ครบถ้วน', 'กรุณากรอกรหัสผ่านสำหรับผู้ใช้ใหม่');
                return;
            }
            
            const userData = {
                username: username,
                fullName: fullName,
                role: role,
                updatedBy: currentUser.username,
                updatedAt: new Date().toISOString(),
                isActive: true
            };
            
            // ถ้ามีการกรอกรหัสผ่านใหม่ ให้เพิ่มรหัสผ่าน
            if (password) {
                userData.password = password;
            }
            
            if (userId) {
                database.ref('users/' + userId).update(userData)
                    .then(() => {
                        hideUserModal();
                        showAlert('success', 'อัพเดทสำเร็จ', 'อัพเดทข้อมูลผู้ใช้เรียบร้อยแล้ว');
                    })
                    .catch(error => {
                        console.error('Error updating user:', error);
                        showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการอัพเดทข้อมูลผู้ใช้');
                    });
            } else {
                const isDuplicate = users.some(user => user.username === username);
                if (isDuplicate) {
                    showAlert('error', 'ข้อมูลซ้ำ', 'ชื่อผู้ใช้นี้มีอยู่ในระบบแล้ว กรุณาใช้ชื่ออื่น');
                    return;
                }
                
                userData.createdAt = new Date().toISOString();
                userData.createdBy = currentUser.username;
                userData.password = password;
                
                database.ref('users/' + username).set(userData)
                    .then(() => {
                        hideUserModal();
                        showAlert('success', 'เพิ่มสำเร็จ', 'เพิ่มผู้ใช้ใหม่เรียบร้อยแล้ว');
                    })
                    .catch(error => {
                        console.error('Error adding user:', error);
                        showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการเพิ่มผู้ใช้');
                    });
            }
        }
        
        // แก้ไขผู้ใช้
        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                showUserModal(user);
            }
        }
        
        // แสดง Confirmation สำหรับลบผู้ใช้
        function showDeleteUserConfirm(userId, userName) {
            if (!checkPermission('canManageUsers')) {
                showAlert('error', 'ไม่มีสิทธิ์', 'ขออภัย คุณไม่มีสิทธิ์จัดการผู้ใช้');
                return;
            }
            
            if (userId === currentUser.username) {
                showAlert('error', 'ไม่สามารถดำเนินการได้', 'ไม่สามารถลบบัญชีผู้ใช้ปัจจุบันได้');
                return;
            }
            
            userToDelete = userId;
            
            showConfirmation(
                'ยืนยันการลบข้อมูลผู้ใช้',
                `คุณแน่ใจหรือไม่ว่าต้องการลบผู้ใช้ "${userName}"? การกระทำนี้ไม่สามารถย้อนกลับได้`,
                'warning',
                'ลบข้อมูล',
                'ยกเลิก'
            ).then(confirmed => {
                if (confirmed) {
                    deleteUser();
                } else {
                    userToDelete = null;
                }
            });
        }
        
        // ลบผู้ใช้
        function deleteUser() {
            if (!userToDelete || !checkPermission('canManageUsers')) {
                showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์ลบข้อมูลผู้ใช้');
                return;
            }
            
            showLoading('กำลังลบข้อมูลผู้ใช้...');
            
            database.ref('users/' + userToDelete).remove()
                .then(() => {
                    hideLoading();
                    showAlert('success', 'ลบสำเร็จ', 'ลบข้อมูลผู้ใช้เรียบร้อยแล้ว');
                    userToDelete = null;
                })
                .catch(error => {
                    console.error('Error deleting user:', error);
                    hideLoading();
                    showAlert('error', 'ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการลบข้อมูลผู้ใช้');
                    userToDelete = null;
                });
        }
        
        // ออกจากระบบ
        function logout() {
            showConfirmation(
                'ออกจากระบบ',
                'คุณแน่ใจหรือไม่ว่าต้องการออกจากระบบ?',
                'question',
                'ออกจากระบบ',
                'ยกเลิก'
            ).then(confirmed => {
                if (confirmed) {
                    // ล้าง Auto Refresh
                    if (autoRefreshInterval) {
                        clearInterval(autoRefreshInterval);
                    }
                    
                    localStorage.removeItem('inventoryUser');
                    currentUser = null;
                    products = [];
                    users = [];
                    sales = [];
                    showLogin();
                    showAlert('success', 'ออกจากระบบสำเร็จ', 'คุณได้ออกจากระบบเรียบร้อยแล้ว');
                }
            });
        }
        
        // ส่งออกข้อมูลสินค้า
        function exportProducts() {
            showLoading('กำลังเตรียมข้อมูลสำหรับส่งออก...');
            
            let csvContent = "รหัสสินค้า,ชื่อสินค้า,ประเภท,จำนวน,ราคาต่อหน่วย,มูลค่ารวม,สถานะ,วันที่สร้าง\n";
            
            products.forEach(product => {
                const totalValue = product.quantity * product.price;
                const isLowStock = product.quantity <= 5 && product.quantity > 0;
                const isOutOfStock = product.quantity <= 0;
                
                let status = 'พร้อมจำหน่าย';
                if (isLowStock) status = 'เหลือน้อย';
                if (isOutOfStock) status = 'หมดสต๊อก';
                
                const createdDate = product.createdAt ? new Date(product.createdAt).toLocaleDateString('th-TH') : '';
                
                csvContent += `"${product.productCode}","${product.productName}","${product.category}",${product.quantity},${product.price},${totalValue},"${status}","${createdDate}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", `สินค้า_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            hideLoading();
            showAlert('success', 'ส่งออกสำเร็จ', 'ส่งออกข้อมูลสินค้าเป็นไฟล์ CSV เรียบร้อยแล้ว');
        }
        
        // ==================== EVENT LISTENERS ====================
        
        // เริ่มต้นแอพพลิเคชันเมื่อโหลดหน้าเว็บเสร็จ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ระบบกำลังเริ่มต้น...');
            checkUserAndPermissions();
            
            // ========== LOGIN PAGE EVENT LISTENERS ==========
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
                    
                    if (!username || !password) {
                        showAlert('error', 'ข้อมูลไม่ครบถ้วน', 'กรุณากรอกชื่อผู้ใช้และรหัสผ่าน');
                        return;
                    }
                    
                    loginUser(username, password);
                });
            }
            
            // ========== NAVIGATION EVENT LISTENERS ==========
            document.getElementById('navDashboard')?.addEventListener('click', () => showPage('dashboardPage'));
            document.getElementById('navProducts')?.addEventListener('click', () => showPage('productsPage'));
            document.getElementById('navSales')?.addEventListener('click', () => {
                if (checkPermission('canSale')) {
                    showPage('salesPage');
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์เข้าถึงหน้าจัดการการขาย');
                }
            });
            document.getElementById('navSalesReport')?.addEventListener('click', () => {
                if (checkPermission('canViewReports')) {
                    showPage('salesReportPage');
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์เข้าถึงหน้ารายงานการขาย');
                }
            });
            document.getElementById('navUsers')?.addEventListener('click', () => {
                if (checkPermission('canManageUsers')) {
                    showPage('usersPage');
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์เข้าถึงหน้าจัดการผู้ใช้');
                }
            });
            document.getElementById('navReports')?.addEventListener('click', () => {
                if (checkPermission('canViewReports')) {
                    showPage('reportsPage');
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์เข้าถึงหน้ารายงาน');
                }
            });
            document.getElementById('navSettings')?.addEventListener('click', () => {
                if (checkPermission('canManageSettings')) {
                    showPage('settingsPage');
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์เข้าถึงหน้าตั้งค่าระบบ');
                }
            });
            
            document.getElementById('homeBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('dashboardPage');
            });
            
            document.getElementById('userInfoBtn')?.addEventListener('click', showUserProfile);
            
            // ========== DASHBOARD PAGE EVENT LISTENERS ==========
            document.getElementById('quickAddSaleBtn')?.addEventListener('click', () => {
                if (checkPermission('canSale')) {
                    showPage('salesPage');
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์ขายสินค้า');
                }
            });
            
            // ========== PRODUCTS PAGE EVENT LISTENERS ==========
            document.getElementById('addProductMainBtn')?.addEventListener('click', () => {
                if (checkPermission('canAdd')) {
                    showProductModal();
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์เพิ่มสินค้า');
                }
            });
            
            document.getElementById('quickAddProductBtn')?.addEventListener('click', () => {
                if (checkPermission('canAdd')) {
                    showProductModal();
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์เพิ่มสินค้า');
                }
            });
            
            document.getElementById('productForm')?.addEventListener('submit', saveProduct);
            document.getElementById('cancelProductModalBtn')?.addEventListener('click', hideProductModal);
            document.getElementById('exportProductsBtn')?.addEventListener('click', exportProducts);
            document.getElementById('refreshProductsBtn')?.addEventListener('click', () => {
                loadProducts();
                showToast('กำลังรีเฟรชข้อมูลสินค้า...', 'info');
            });
            
            // ========== SALES PAGE EVENT LISTENERS ==========
            document.getElementById('newSaleBtn')?.addEventListener('click', () => {
                // โฟกัสไปที่ฟอร์มขายใหม่
                document.getElementById('newSaleForm').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('addSaleItemBtn')?.addEventListener('click', addSaleItem);
            document.getElementById('saleForm')?.addEventListener('submit', saveSale);
            document.getElementById('clearSaleBtn')?.addEventListener('click', clearSaleForm);
            document.getElementById('refreshSalesBtn')?.addEventListener('click', () => {
                loadSales();
                showToast('กำลังรีเฟรชข้อมูลการขาย...', 'info');
            });
            
            // ========== SALES REPORT PAGE EVENT LISTENERS ==========
            document.getElementById('reportPeriod')?.addEventListener('change', function() {
                const customDateRange = document.getElementById('customDateRange');
                if (this.value === 'custom') {
                    customDateRange.classList.remove('hidden');
                } else {
                    customDateRange.classList.add('hidden');
                }
            });
            
            document.getElementById('generateReportBtn')?.addEventListener('click', function() {
                const period = document.getElementById('reportPeriod').value;
                generateSalesReport(period);
            });
            
            document.getElementById('exportSalesReportBtn')?.addEventListener('click', exportSalesReport);
            document.getElementById('printSalesReportBtn')?.addEventListener('click', () => {
                showAlert('info', 'พิมพ์รายงาน', 'ฟังก์ชันพิมพ์รายงานอยู่ระหว่างการพัฒนา');
            });
            
            // ========== USERS PAGE EVENT LISTENERS ==========
            document.getElementById('addUserBtn')?.addEventListener('click', () => {
                if (checkPermission('canManageUsers')) {
                    showUserModal();
                } else {
                    showAlert('error', 'ไม่มีสิทธิ์', 'คุณไม่มีสิทธิ์เพิ่มผู้ใช้');
                }
            });
            
            document.getElementById('userForm')?.addEventListener('submit', saveUser);
            document.getElementById('cancelUserModalBtn')?.addEventListener('click', hideUserModal);
            document.getElementById('refreshUsersBtn')?.addEventListener('click', () => {
                loadUsers();
                showToast('กำลังรีเฟรชข้อมูลผู้ใช้...', 'info');
            });
            
            // ========== REPORTS PAGE EVENT LISTENERS ==========
            const reportTabs = document.querySelectorAll('.tab');
            reportTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    reportTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(tabId).classList.remove('hidden');
                });
            });
            
            // ========== MODAL EVENT LISTENERS ==========
            document.getElementById('closeSaleDetailBtn')?.addEventListener('click', () => {
                document.getElementById('saleDetailModal').classList.add('hidden');
            });
            
            document.getElementById('printReceiptBtn')?.addEventListener('click', printReceipt);
            
            // ========== GENERAL EVENT LISTENERS ==========
            document.getElementById('logoutBtn')?.addEventListener('click', logout);
            
            document.getElementById('quickHelpBtn')?.addEventListener('click', () => {
                showAlert('info', 'วิธีใช้งานระบบ', 
                    '🛒 **ระบบจัดการการขาย:**\n' +
                    '- ขายสินค้า: คลิกเมนู "จัดการการขาย" หรือปุ่ม "ขายสินค้า" ในแดชบอร์ด\n' +
                    '- เพิ่มรายการสินค้า: คลิกปุ่ม "เพิ่มสินค้า" ในฟอร์มขาย\n' +
                    '- ตัดสต๊อก: ระบบจะตัดสต๊อกอัตโนมัติเมื่อบันทึกการขาย\n' +
                    '- ดูประวัติการขาย: คลิกเมนู "รายงานการขาย" เพื่อดูสรุปรายวัน/รายเดือน\n\n' +
                    '📊 **รายงานการขาย:**\n' +
                    '- สรุปรายวัน: ดูยอดขายและสถิติประจำวัน\n' +
                    '- สรุปรายเดือน: วิเคราะห์แนวโน้มการขาย\n' +
                    '- สินค้าขายดี: ดูสินค้าขายดีอันดับต้นๆ\n' +
                    '- ส่งออกรายงาน: ส่งออกรายงานการขายเป็นไฟล์ CSV\n\n' +
                    '📦 **จัดการสินค้า:**\n' +
                    '- เพิ่มสินค้า: คลิกปุ่ม "เพิ่มสินค้าใหม่"\n' +
                    '- แก้ไข/ลบสินค้า: คลิกปุ่มจัดการในตาราง\n' +
                    '- ตรวจสอบสต๊อก: ดูสถานะสินค้าในตาราง'
                );
            });
            
            // ปิด Modal เมื่อคลิกพื้นหลัง
            document.getElementById('productModal')?.addEventListener('click', function(e) {
                if (e.target === this) hideProductModal();
            });
            
            document.getElementById('userModal')?.addEventListener('click', function(e) {
                if (e.target === this) hideUserModal();
            });
            
            document.getElementById('saleDetailModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });
            
            // อัพเดทเวลาปัจจุบันทุกวินาที
            setInterval(updateSystemTime, 1000);
            
            // แสดงข้อความต้อนรับ
            console.log('ระบบพร้อมใช้งานแล้ว!');
            console.log('บัญชีทดสอบ:');
            console.log('- ผู้ใช้ทั่วไป: user / user123');
            console.log('- ผู้จัดการ: manager / manager123');
            console.log('- ผู้ดูแลระบบ: admin / admin123');
        });
        
        // ทำให้ฟังก์ชันสามารถเรียกใช้จาก onclick ใน HTML ได้
        window.editProduct = editProduct;
        window.showDeleteProductConfirm = showDeleteProductConfirm;
        window.editUser = editUser;
        window.showDeleteUserConfirm = showDeleteUserConfirm;
        window.showSaleDetail = showSaleDetail;
        window.showDeleteSaleConfirm = showDeleteSaleConfirm;
        window.addSaleItem = addSaleItem;
        window.removeSaleItem = removeSaleItem;
        window.updateSaleItemPrice = updateSaleItemPrice;
        window.updateSaleItemTotal = updateSaleItemTotal;
        window.closeAlert = closeAlert;
    </script>
</body>
</html>
